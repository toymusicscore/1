<!DOCTYPE html>
<html>
<head>
<meta charaset="UTF-8"/>
<title>
Local
</title>
</head>
<body style="font-size:160%" >
<basefont face="Arial">
<form name="form1" >
MIDI<input type="file" id="selfile1" style="font-size:100%">
TSV<input type="file" id="selfile2" style="font-size:100%">
<br>
<select name="hg1" onChange="height1()" style="font-size:100%">
	<option value="0" style="font-size:100%"> H1 </option>
	<option value="1" style="font-size:100%" selected="selected"> H2</option>
	<option value="2" style="font-size:100%"> H3</option>
	<option value="3" style="font-size:100%"> H4</option>
	<option value="4" style="font-size:100%"> H5</option>
	<option value="5" style="font-size:100%"> H6</option>
	<option value="6" style="font-size:100%"> H7</option>
	<option value="7" style="font-size:100%"> H8</option>
	<option value="8" style="font-size:100%"> H9</option>
	<option value="9" style="font-size:100%"> H10</option>
	</select>

<select name="tr1" onChange="transpose1()" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> T+0 </option>
	<option value="1" style="font-size:100%"> T+1</option>
	<option value="2" style="font-size:100%"> T+2</option>
	<option value="3" style="font-size:100%"> T+3</option>
	<option value="4" style="font-size:100%"> T+4</option>
	<option value="5" style="font-size:100%"> T+5</option>
	<option value="6" style="font-size:100%"> T+6</option>
	<option value="7" style="font-size:100%"> T+7</option>
	<option value="8" style="font-size:100%"> T+8</option>
	<option value="9" style="font-size:100%"> T+9</option>
	<option value="10" style="font-size:100%"> T+10</option>
	<option value="11" style="font-size:100%"> T+11</option>
	<option value="12" style="font-size:100%"> T+12</option>
	<option value="13" style="font-size:100%"> T-1</option>
	<option value="14" style="font-size:100%"> T-2</option>
	<option value="15" style="font-size:100%"> T-3</option>
	<option value="16" style="font-size:100%"> T-4</option>
	<option value="17" style="font-size:100%"> T-5</option>
	<option value="18" style="font-size:100%"> T-6</option>
	<option value="19" style="font-size:100%"> T-7</option>
	<option value="20" style="font-size:100%"> T-8</option>
	<option value="21" style="font-size:100%"> T-9</option>
	<option value="22" style="font-size:100%"> T-10</option>
	<option value="23" style="font-size:100%"> T-11</option>
	<option value="24" style="font-size:100%"> T-12</option>
	</select>

<select name="chn1" onChange="channel1()" style="font-size:100%">
	<option value="0" style="font-size:100%"> Ch1 </option>
	<option value="1" style="font-size:100%"> Ch2</option>
	<option value="2" style="font-size:100%"> Ch3</option>
	<option value="3" style="font-size:100%"> Ch4</option>
	<option value="4" style="font-size:100%"> Ch5</option>
	<option value="5" style="font-size:100%"> Ch6</option>
	<option value="6" style="font-size:100%"> Ch7</option>
	<option value="7" style="font-size:100%"> Ch8</option>
	<option value="8" style="font-size:100%"> Ch9</option>
	<option value="9" style="font-size:100%"> Ch10</option>
	<option value="10" style="font-size:100%"> Ch11</option>
	<option value="11" style="font-size:100%"> Ch12</option>
	<option value="12" style="font-size:100%"> Ch13</option>
	<option value="13" style="font-size:100%"> Ch14</option>
	<option value="14" style="font-size:100%"> Ch15</option>
	<option value="15" style="font-size:100%"> Ch16</option>
	<option value="16" style="font-size:100%" selected="selected"> ChAll</option>
	</select>

<select name="fg1" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> RH </option>
	<option value="1" style="font-size:100%"> LH</option>
	</select>

<select name="fg2" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> L0 </option>
	<option value="1" style="font-size:100%"> L1 </option>
	<option value="2" style="font-size:100%"> L2 </option>
	</select>

<select name="fg3" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> X0 </option>
	<option value="1" style="font-size:100%"> X1 </option>
	</select>

<select name="fg4" style="font-size:100%">
	<option value="0" style="font-size:100%"> C0 </option>
	<option value="1" style="font-size:100%"> C1 </option>
	<option value="2" style="font-size:100%"> C2 </option>
	<option value="3" style="font-size:100%"> C3 </option>
	<option value="4" style="font-size:100%"> C4 </option>
	<option value="5" style="font-size:100%" selected="selected"> C5 </option>
	</select>

<select name="fg41" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> 10 </option>
	<option value="1" style="font-size:100%"> 11 </option>
	<option value="2" style="font-size:100%"> 12 </option>
	<option value="3" style="font-size:100%"> 13 </option>
	<option value="4" style="font-size:100%"> 14 </option>
	<option value="5" style="font-size:100%"> 15 </option>
	</select>

<select name="fg42" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> 20 </option>
	<option value="1" style="font-size:100%"> 21 </option>
	<option value="2" style="font-size:100%"> 22 </option>
	<option value="3" style="font-size:100%"> 23 </option>
	<option value="4" style="font-size:100%"> 24 </option>
	<option value="5" style="font-size:100%"> 25 </option>
	</select>

<select name="fg43" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> 30 </option>
	<option value="1" style="font-size:100%"> 31 </option>
	<option value="2" style="font-size:100%"> 32 </option>
	<option value="3" style="font-size:100%"> 33 </option>
	<option value="4" style="font-size:100%"> 34 </option>
	<option value="5" style="font-size:100%"> 35 </option>
	</select>

<select name="fg44" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> 40 </option>
	<option value="1" style="font-size:100%"> 41 </option>
	<option value="2" style="font-size:100%"> 42 </option>
	<option value="3" style="font-size:100%"> 43 </option>
	<option value="4" style="font-size:100%"> 44 </option>
	<option value="5" style="font-size:100%"> 45 </option>
	</select>

<select name="fg45" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> 50 </option>
	<option value="1" style="font-size:100%"> 51 </option>
	<option value="2" style="font-size:100%"> 52 </option>
	<option value="3" style="font-size:100%"> 53 </option>
	<option value="4" style="font-size:100%"> 54 </option>
	<option value="5" style="font-size:100%"> 55 </option>
	</select>

<select name="fg5" style="font-size:100%">
	<option value="0" style="font-size:100%"> N6 </option>
	<option value="1" style="font-size:100%"> N7 </option>
	<option value="2" style="font-size:100%"> N8 </option>
	<option value="3" style="font-size:100%"> N9 </option>
	<option value="4" style="font-size:100%"> N10 </option>
	<option value="5" style="font-size:100%"> N11 </option>
	<option value="6" style="font-size:100%"> N12 </option>
	<option value="7" style="font-size:100%"> N13 </option>
	<option value="8" style="font-size:100%"> N14 </option>
	<option value="9" style="font-size:100%" selected="selected"> N15 </option>
	<option value="10" style="font-size:100%"> N16 </option>
	<option value="11" style="font-size:100%"> N17 </option>
	<option value="12" style="font-size:100%"> N18 </option>
	</select>

<select name="fg6" style="font-size:100%">
	<option value="0" style="font-size:100%"> n2 </option>
	<option value="1" style="font-size:100%" selected="selected"> n3 </option>
	<option value="2" style="font-size:100%"> n4 </option>
	<option value="3" style="font-size:100%"> n5 </option>
	<option value="4" style="font-size:100%"> n6 </option>
	</select>

<select name="fg7" style="font-size:100%">
	<option value="0" style="font-size:100%"> r1 </option>
	<option value="1" style="font-size:100%"> r2 </option>
	<option value="2" style="font-size:100%"> r4 </option>
	<option value="3" style="font-size:100%"> r8 </option>
	<option value="4" style="font-size:100%" selected="selected"> r16 </option>
	<option value="5" style="font-size:100%"> r32 </option>
	<option value="6" style="font-size:100%"> r64 </option>
	</select>

<select name="fg8" style="font-size:100%">
	<option value="0" style="font-size:100%"> R1 </option>
	<option value="1" style="font-size:100%"> R2 </option>
	<option value="2" style="font-size:100%" selected="selected"> R4 </option>
	<option value="3" style="font-size:100%"> R8 </option>
	<option value="4" style="font-size:100%"> R16 </option>
	<option value="5" style="font-size:100%"> R32 </option>
	<option value="6" style="font-size:100%"> R64 </option>
	</select>

<select name="nl1" onChange="selview1()" style="font-size:100%">
	<option value="0" style="font-size:100%"> No Letters </option>
	<option value="1" style="font-size:100%"> DoReMi # </option>
	<option value="2" style="font-size:100%"> DoReMi b </option>
	<option value="3" style="font-size:100%"> ABC E # </option>
	<option value="4" style="font-size:100%"> ABC E b </option>
	<option value="5" style="font-size:100%"> ABC G # </option>
	<option value="6" style="font-size:100%"> ABC G b </option>
	<option value="7" style="font-size:100%"> Pitch Class </option>
	<option value="8" style="font-size:100%"> MIDI Duodecimal </option>
	<option value="9" style="font-size:100%"> MIDI Number </option>
	<option value="10" style="font-size:100%"> Note ID </option>
	<option value="11" style="font-size:100%" selected="selected"> TSV Fingering </option>
	<option value="12" style="font-size:100%"> TSV Memo </option>
	<option value="13" style="font-size:100%"> TSV Fingering n3 </option>
	<option value="14" style="font-size:100%" > TSV Fingering n4 </option>
	<option value="15" style="font-size:100%" > TSV Fingering n5 </option>
	<option value="16" style="font-size:100%" > TSV Lyrics1 </option>
	<option value="17" style="font-size:100%" > TSV Lyrics2 </option>
	<option value="18" style="font-size:100%" > Fingering No.1 </option>
	<option value="19" style="font-size:100%" > Fingering No.2 </option>
	<option value="20" style="font-size:100%" > Fingering No.3 </option>
	<option value="21" style="font-size:100%" > Fingering No.4 </option>
	<option value="22" style="font-size:100%" > Fingering No.5 </option>
	<option value="23" style="font-size:100%" > Fingering No.6 </option>
	<option value="24" style="font-size:100%" > Fingering No.7 </option>
	<option value="25" style="font-size:100%" > Fingering No.8 </option>
	<option value="26" style="font-size:100%" > Fingering No.9 </option>
	<option value="27" style="font-size:100%" > Fingering No.10 </option>
	</select>

<select name="sv1" onChange="selview1()" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> Scroll Landscape </option>
	<option value="1" style="font-size:100%"> Scroll Portrait</option>
	<option value="2" style="font-size:100%"> Still Landscape </option>
	<option value="3" style="font-size:100%"> Still Portrait </option>
	<option value="4" style="font-size:100%"> Color Sample </option>
	<option value="5" style="font-size:100%"> Touch Sound </option>
	<option value="6" style="font-size:100%"> Channel Colors </option>
	<option value="7" style="font-size:100%"> Key 10</option>
	<option value="8" style="font-size:100%"> Key 20</option>
	<option value="9" style="font-size:100%"> Key 25</option>
	<option value="10" style="font-size:100%"> Index </option>
	<option value="11" style="font-size:100%"> Information </option>
	<option value="12" style="font-size:100%"> Pythagorean Tuning</option>
	<option value="13" style="font-size:100%"> Just Intonation</option>
	<option value="14" style="font-size:100%"> 12 Equal Temperament</option>
	<option value="15" style="font-size:100%"> Fingering Assistant</option>
	<option value="16" style="font-size:100%"> Fingering Recorder</option>
	<option value="17" style="font-size:100%"> Fingering Downloader</option>
	<option value="18" style="font-size:100%"> MIDI TSV Downloader</option>
	<option value="19" style="font-size:100%"> Cover L Downloader</option>
	<option value="20" style="font-size:100%"> Cover P Downloader</option>
	</select>
	
<br>
<select name="smsr1" onChange="setmsr1()" style="font-size:100%">
	<option value="0" style="font-size:100%"> 0 </option>
	<option value="1" style="font-size:100%" selected="selected"> 1 </option>
	<option value="2" style="font-size:100%"> 2 </option>
	<option value="3" style="font-size:100%"> 3 </option>
	<option value="4" style="font-size:100%"> 4 </option>
	<option value="5" style="font-size:100%"> 5 </option>
	<option value="6" style="font-size:100%"> 6 </option>
	<option value="7" style="font-size:100%"> 7 </option>
	<option value="8" style="font-size:100%"> 8 </option>
	<option value="9" style="font-size:100%"> 9 </option>
	<option value="10" style="font-size:100%"> 10 </option>
	<option value="11" style="font-size:100%"> 11 </option>
	<option value="12" style="font-size:100%"> 12 </option>
	<option value="13" style="font-size:100%"> 13 </option>
	<option value="14" style="font-size:100%"> 14 </option>
	<option value="15" style="font-size:100%"> 15 </option>
	<option value="16" style="font-size:100%"> 16 </option>
	<option value="17" style="font-size:100%"> 17 </option>
	<option value="18" style="font-size:100%"> 18 </option>
	<option value="19" style="font-size:100%"> 19 </option>
	<option value="20" style="font-size:100%"> 20 </option>
	<option value="21" style="font-size:100%"> 21 </option>
	<option value="22" style="font-size:100%"> 22 </option>
	<option value="23" style="font-size:100%"> 23 </option>
	<option value="24" style="font-size:100%"> 24 </option>
	<option value="25" style="font-size:100%"> 25 </option>
	<option value="26" style="font-size:100%"> 26 </option>
	<option value="27" style="font-size:100%"> 27 </option>
	<option value="28" style="font-size:100%"> 28 </option>
	<option value="29" style="font-size:100%"> 29 </option>
	<option value="30" style="font-size:100%"> 30 </option>
	<option value="31" style="font-size:100%"> 31 </option>
	<option value="32" style="font-size:100%"> 32 </option>
	<option value="33" style="font-size:100%"> 33 </option>
	<option value="34" style="font-size:100%"> 34 </option>
	<option value="35" style="font-size:100%"> 35 </option>
	<option value="36" style="font-size:100%"> 36 </option>
	<option value="37" style="font-size:100%"> 37 </option>
	<option value="38" style="font-size:100%"> 38 </option>
	<option value="39" style="font-size:100%"> 39 </option>
	<option value="40" style="font-size:100%"> 40 </option>
	<option value="41" style="font-size:100%"> 41 </option>
	<option value="42" style="font-size:100%"> 42 </option>
	<option value="43" style="font-size:100%"> 43 </option>
	<option value="44" style="font-size:100%"> 44 </option>
	<option value="45" style="font-size:100%"> 45 </option>
	<option value="46" style="font-size:100%"> 46 </option>
	<option value="47" style="font-size:100%"> 47 </option>
	<option value="48" style="font-size:100%"> 48 </option>
	<option value="49" style="font-size:100%"> 49 </option>
	<option value="50" style="font-size:100%"> 50 </option>
	<option value="51" style="font-size:100%"> 51 </option>
	<option value="52" style="font-size:100%"> 52 </option>
	<option value="53" style="font-size:100%"> 53 </option>
	<option value="54" style="font-size:100%"> 54 </option>
	<option value="55" style="font-size:100%"> 55 </option>
	<option value="56" style="font-size:100%"> 56 </option>
	<option value="57" style="font-size:100%"> 57 </option>
	<option value="58" style="font-size:100%"> 58 </option>
	<option value="59" style="font-size:100%"> 59 </option>
	<option value="60" style="font-size:100%"> 60 </option>
	<option value="61" style="font-size:100%"> 61 </option>
	<option value="62" style="font-size:100%"> 62 </option>
	<option value="63" style="font-size:100%"> 63 </option>
	<option value="64" style="font-size:100%"> 64 </option>
	<option value="65" style="font-size:100%"> 65 </option>
	<option value="66" style="font-size:100%"> 66 </option>
	<option value="67" style="font-size:100%"> 67 </option>
	<option value="68" style="font-size:100%"> 68 </option>
	<option value="69" style="font-size:100%"> 69 </option>
	<option value="70" style="font-size:100%"> 70 </option>
	<option value="71" style="font-size:100%"> 71 </option>
	<option value="72" style="font-size:100%"> 72 </option>
	<option value="73" style="font-size:100%"> 73 </option>
	<option value="74" style="font-size:100%"> 74 </option>
	<option value="75" style="font-size:100%"> 75 </option>
	<option value="76" style="font-size:100%"> 76 </option>
	<option value="77" style="font-size:100%"> 77 </option>
	<option value="78" style="font-size:100%"> 78 </option>
	<option value="79" style="font-size:100%"> 79 </option>
	<option value="80" style="font-size:100%"> 80 </option>
	<option value="81" style="font-size:100%"> 81 </option>
	<option value="82" style="font-size:100%"> 82 </option>
	<option value="83" style="font-size:100%"> 83 </option>
	<option value="84" style="font-size:100%"> 84 </option>
	<option value="85" style="font-size:100%"> 85 </option>
	<option value="86" style="font-size:100%"> 86 </option>
	<option value="87" style="font-size:100%"> 87 </option>
	<option value="88" style="font-size:100%"> 88 </option>
	<option value="89" style="font-size:100%"> 89 </option>
	<option value="90" style="font-size:100%"> 90 </option>
	<option value="91" style="font-size:100%"> 91 </option>
	<option value="92" style="font-size:100%"> 92 </option>
	<option value="93" style="font-size:100%"> 93 </option>
	<option value="94" style="font-size:100%"> 94 </option>
	<option value="95" style="font-size:100%"> 95 </option>
	<option value="96" style="font-size:100%"> 96 </option>
	<option value="97" style="font-size:100%"> 97 </option>
	<option value="98" style="font-size:100%"> 98 </option>
	<option value="99" style="font-size:100%"> 99 </option>
	<option value="100" style="font-size:100%"> 100 </option>
	<option value="101" style="font-size:100%"> 101 </option>
	<option value="102" style="font-size:100%"> 102 </option>
	<option value="103" style="font-size:100%"> 103 </option>
	<option value="104" style="font-size:100%"> 104 </option>
	<option value="105" style="font-size:100%"> 105 </option>
	<option value="106" style="font-size:100%"> 106 </option>
	<option value="107" style="font-size:100%"> 107 </option>
	<option value="108" style="font-size:100%"> 108 </option>
	<option value="109" style="font-size:100%"> 109 </option>
	<option value="110" style="font-size:100%"> 110 </option>
	<option value="111" style="font-size:100%"> 111 </option>
	<option value="112" style="font-size:100%"> 112 </option>
	<option value="113" style="font-size:100%"> 113 </option>
	<option value="114" style="font-size:100%"> 114 </option>
	<option value="115" style="font-size:100%"> 115 </option>
	<option value="116" style="font-size:100%"> 116 </option>
	<option value="117" style="font-size:100%"> 117 </option>
	<option value="118" style="font-size:100%"> 118 </option>
	<option value="119" style="font-size:100%"> 119 </option>
	<option value="120" style="font-size:100%"> 120 </option>
</select>

<input type="tel"    name="x_msr" value="0" size="3" style="font-size:100%" >
<input type="button" name="b_msr" value="M" onClick="msr1()" style="font-size:100%" >
<input type="tel"    name="x_msrf" value="0" size="3" style="font-size:100%" >
<input type="tel"    name="x_msrt" value="0" size="3" style="font-size:100%" >
<input type="button" name="b_k" value="K" onClick="keyw2()" style="font-size:100%" >

<select name="sbpm1" onChange="setbpm1()" style="font-size:100%">
	<option value="0" style="font-size:100%" selected="selected"> 0 </option>
	<option value="1" style="font-size:100%"> 1 </option>
	<option value="2" style="font-size:100%"> 2 </option>
	<option value="3" style="font-size:100%"> 3 </option>
	<option value="4" style="font-size:100%"> 4 </option>
	<option value="5" style="font-size:100%"> 5 </option>
	<option value="6" style="font-size:100%"> 6 </option>
	<option value="7" style="font-size:100%"> 7 </option>
	<option value="8" style="font-size:100%"> 8 </option>
	<option value="9" style="font-size:100%"> 9 </option>
	<option value="10" style="font-size:100%"> 10 </option>
	<option value="11" style="font-size:100%"> 11 </option>
	<option value="12" style="font-size:100%"> 12 </option>
	<option value="13" style="font-size:100%"> 13 </option>
	<option value="14" style="font-size:100%"> 14 </option>
	<option value="15" style="font-size:100%"> 15 </option>
	<option value="16" style="font-size:100%"> 16 </option>
	<option value="17" style="font-size:100%"> 17 </option>
	<option value="18" style="font-size:100%"> 18 </option>
	<option value="19" style="font-size:100%"> 19 </option>
	<option value="20" style="font-size:100%"> 20 </option>
	<option value="21" style="font-size:100%"> 21 </option>
	<option value="22" style="font-size:100%"> 22 </option>
	<option value="23" style="font-size:100%"> 23 </option>
	<option value="24" style="font-size:100%"> 24 </option>
	<option value="25" style="font-size:100%"> 25 </option>
	<option value="26" style="font-size:100%"> 26 </option>
	<option value="27" style="font-size:100%"> 27 </option>
	<option value="28" style="font-size:100%"> 28 </option>
	<option value="29" style="font-size:100%"> 29 </option>
	<option value="30" style="font-size:100%"> 30 </option>
	<option value="31" style="font-size:100%"> 31 </option>
	<option value="32" style="font-size:100%"> 32 </option>
	<option value="33" style="font-size:100%"> 33 </option>
	<option value="34" style="font-size:100%"> 34 </option>
	<option value="35" style="font-size:100%"> 35 </option>
	<option value="36" style="font-size:100%"> 36 </option>
	<option value="37" style="font-size:100%"> 37 </option>
	<option value="38" style="font-size:100%"> 38 </option>
	<option value="39" style="font-size:100%"> 39 </option>
	<option value="40" style="font-size:100%"> 40 </option>
	<option value="41" style="font-size:100%"> 41 </option>
	<option value="42" style="font-size:100%"> 42 </option>
	<option value="43" style="font-size:100%"> 43 </option>
	<option value="44" style="font-size:100%"> 44 </option>
	<option value="45" style="font-size:100%"> 45 </option>
	<option value="46" style="font-size:100%"> 46 </option>
	<option value="47" style="font-size:100%"> 47 </option>
	<option value="48" style="font-size:100%"> 48 </option>
	<option value="49" style="font-size:100%"> 49 </option>
	<option value="50" style="font-size:100%"> 50 </option>
	<option value="51" style="font-size:100%"> 51 </option>
	<option value="52" style="font-size:100%"> 52 </option>
	<option value="53" style="font-size:100%"> 53 </option>
	<option value="54" style="font-size:100%"> 54 </option>
	<option value="55" style="font-size:100%"> 55 </option>
	<option value="56" style="font-size:100%"> 56 </option>
	<option value="57" style="font-size:100%"> 57 </option>
	<option value="58" style="font-size:100%"> 58 </option>
	<option value="59" style="font-size:100%"> 59 </option>
	<option value="60" style="font-size:100%"> 60 </option>
	<option value="61" style="font-size:100%"> 61 </option>
	<option value="62" style="font-size:100%"> 62 </option>
	<option value="63" style="font-size:100%"> 63 </option>
	<option value="64" style="font-size:100%"> 64 </option>
	<option value="65" style="font-size:100%"> 65 </option>
	<option value="66" style="font-size:100%"> 66 </option>
	<option value="67" style="font-size:100%"> 67 </option>
	<option value="68" style="font-size:100%"> 68 </option>
	<option value="69" style="font-size:100%"> 69 </option>
	<option value="70" style="font-size:100%"> 70 </option>
	<option value="71" style="font-size:100%"> 71 </option>
	<option value="72" style="font-size:100%"> 72 </option>
	<option value="73" style="font-size:100%"> 73 </option>
	<option value="74" style="font-size:100%"> 74 </option>
	<option value="75" style="font-size:100%"> 75 </option>
	<option value="76" style="font-size:100%"> 76 </option>
	<option value="77" style="font-size:100%"> 77 </option>
	<option value="78" style="font-size:100%"> 78 </option>
	<option value="79" style="font-size:100%"> 79 </option>
	<option value="80" style="font-size:100%"> 80 </option>
	<option value="81" style="font-size:100%"> 81 </option>
	<option value="82" style="font-size:100%"> 82 </option>
	<option value="83" style="font-size:100%"> 83 </option>
	<option value="84" style="font-size:100%"> 84 </option>
	<option value="85" style="font-size:100%"> 85 </option>
	<option value="86" style="font-size:100%"> 86 </option>
	<option value="87" style="font-size:100%"> 87 </option>
	<option value="88" style="font-size:100%"> 88 </option>
	<option value="89" style="font-size:100%"> 89 </option>
	<option value="90" style="font-size:100%"> 90 </option>
	<option value="91" style="font-size:100%"> 91 </option>
	<option value="92" style="font-size:100%"> 92 </option>
	<option value="93" style="font-size:100%"> 93 </option>
	<option value="94" style="font-size:100%"> 94 </option>
	<option value="95" style="font-size:100%"> 95 </option>
	<option value="96" style="font-size:100%"> 96 </option>
	<option value="97" style="font-size:100%"> 97 </option>
	<option value="98" style="font-size:100%"> 98 </option>
	<option value="99" style="font-size:100%"> 99 </option>
	<option value="100" style="font-size:100%"> 100 </option>
	<option value="101" style="font-size:100%"> 101 </option>
	<option value="102" style="font-size:100%"> 102 </option>
	<option value="103" style="font-size:100%"> 103 </option>
	<option value="104" style="font-size:100%"> 104 </option>
	<option value="105" style="font-size:100%"> 105 </option>
	<option value="106" style="font-size:100%"> 106 </option>
	<option value="107" style="font-size:100%"> 107 </option>
	<option value="108" style="font-size:100%"> 108 </option>
	<option value="109" style="font-size:100%"> 109 </option>
	<option value="110" style="font-size:100%"> 110 </option>
	<option value="111" style="font-size:100%"> 111 </option>
	<option value="112" style="font-size:100%"> 112 </option>
	<option value="113" style="font-size:100%"> 113 </option>
	<option value="114" style="font-size:100%"> 114 </option>
	<option value="115" style="font-size:100%"> 115 </option>
	<option value="116" style="font-size:100%"> 116 </option>
	<option value="117" style="font-size:100%"> 117 </option>
	<option value="118" style="font-size:100%"> 118 </option>
	<option value="119" style="font-size:100%"> 119 </option>
	<option value="120" style="font-size:100%"> 120 </option>
</select>

<input type="tel"    name="x_bpm" value="" size="3" style="font-size:100%" >
<input type="button" name="b_sb" value="BPM" onClick="silent1()" style="font-size:100%" >
<input type="button" name="b_p" value="Play" onClick="play1()" style="font-size:100%" >
<input type="button" name="b_||" value=" || " onClick="pause1()" style="font-size:100%" >
<input type="button" name="b_|<" value="|<" onClick="top1()" style="font-size:100%" >
<input type="button" name="b_<<" value="<<" onClick="reverses()" style="font-size:100%" >
<input type="button" name="b_<" value="<" onClick="reverse1()" style="font-size:100%" >
<input type="button" name="b_>" value=">" onClick="forward1()" style="font-size:100%" >
<input type="button" name="b_>>" value=">>" onClick="forwards()" style="font-size:100%" >
<input type="button" name="b_>|" value=">|" onClick="end1()" style="font-size:100%" >

<span id="ts"></span>
C <span id="channels"></span>
T <span id="pt"></span>
P <span id="prgrs"></span>
<input type="button" name="PDF_Landscape" value="PL" onClick="pdf_l()" style="font-size:100%" >
<input type="button" name="PDF_Portrait" value="PP" onClick="pdf_p()" style="font-size:100%" >
</form>
<canvas id="cv2" width="1300" height="1300">
</canvas>
<div id="credit" style="font-size:80%">
</div>
<script src="https://unpkg.com/picoaudio/dist/browser/PicoAudio.js"></script>
<script src="https://unpkg.com/tone"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const canvas2=document.getElementById("cv2");
const ctx2=canvas2.getContext("2d");
const credit2=document.getElementById("credit");
//const col=["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"];
const col=["#ff0000","#ff7f00","#ffff00","#7fff00","#00cc00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#cc00cc"];
const col2=["#ffffff","#ff0000","#ff7f00","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff007f"];
//const col3=["#ffffff","#ffcccc","#ffffcc","#ccffcc","#ccffff","#ccccff","#ffccff","#ff9999","#ffcc99","#ffff99","#ccff99","#99ff99","#99ffcc","#99ffff","#99ccff","#9999ff","#cc99ff","#ff99ff","#00ffff","#ff99cc"];
const col3=["#ffcccc","#ffcc00","#ccffcc","#ccffff","#ccccff","#ffccff","#ff9999","#ffcc99","#ffff99","#ccff99","#99ff99","#99ffcc","#99ffff","#99ccff","#9999ff","#cc99ff","#ff99ff","#00ffff","#ff99cc"];
const drms1=["Do","Di","Re","Ri","Mi","Fa","Fi","Sol","Si","La","Li","Ti"];
const drmf1=["Do","Ra","Re","Me","Mi","Fa","Se","Sol","Le","La","Te","Ti"];
const engs1=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const engf1=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"];
const gers1=["C","Cis","D","Dis","E","F","Fis","G","Gis","A","Ais","H"];
const gerf1=["C","Des","D","Es","E","F","Ges","G","As","A","B","H"];
const scaler1=["major","minor"];
const scaleMjr0=[0,2,4,5,7,9,11];
const scaleMjrH=[0,2,4,5,7,8,11];
const scaleMjrM=[0,2,4,5,7,8,10];
const scaleMnrH=[0,2,4,5,8,9,11];
const scaleMnrM=[0,2,4,6,8,9,11];
const engMnr1=["C","C#","D","Eb","E","F","F#","G","G#","A","Bb","B"];
const sigMjr1=["#0","b4","#2","b3","#4","b1","b6","#1","b4","#3","b2","#5"];
const sigMnr1=["b3","#4","b1","b6","#1","b4","#3","b2","#5","#0","b5","#2"];
const instName=[
'Acoustic Grand Piano',
'Bright Acoustic Piano',
'Electric Grand Piano',
'Honky-tonk Piano',
'Rhodes Piano',
'Chorused Piano',
'Harpsichord',
'Clavinet',
'Celesta',
'Glockenspiel',
'Music box',
'Vibraphone',
'Marimba',
'Xylophone',
'Tubular Bells',
'Dulcimer',
'Hammond Organ',
'Percussive Organ',
'Rock Organ',
'Church Organ',
'Reed Organ',
'Accordion',
'Harmonica',
'Tango Accordion',
'Acoustic Guitar (nylon)',
'Acoustic Guitar (steel)',
'Electric Guitar (jazz)',
'Electric Guitar (clean)',
'Electric Guitar (muted)',
'Overdriven Guitar',
'Distortion Guitar',
'Guitar Harmonics',
'Acoustic Bass',
'Electric Bass (finger)',
'Electric Bass (pick)',
'Fretless Bass',
'Slap Bass 1',
'Slap Bass 2',
'Synth Bass 1',
'Synth Bass 2',
'Violin',
'Viola',
'Cello',
'Contrabass',
'Tremolo Strings',
'Pizzicato Strings',
'Orchestral Harp',
'Timpani',
'String Ensemble 1',
'String Ensemble 2',
'Synth Strings 1',
'Synth Strings 2',
'Choir Aahs',
'Voice Oohs',
'Synth Voice',
'Orchestra Hit',
'Trumpet',
'Trombone',
'Tuba',
'Muted Trumpet',
'French Horn',
'Brass Section',
'Synth Brass 1',
'Synth Brass 2',
'Soprano Sax',
'Alto Sax',
'Tenor Sax',
'msritone Sax',
'Oboe',
'English Horn',
'Bassoon',
'Clarinet',
'Piccolo',
'Flute',
'Recorder',
'Pan Flute',
'Bottle Blow',
'Shakuhachi',
'Whistle',
'Ocarina',
'Lead 1 (square)',
'Lead 2 (sawtooth)',
'Lead 3 (calliope lead)',
'Lead 4 (chiffer lead)',
'Lead 5 (charang)',
'Lead 6 (voice)',
'Lead 7 (fifths)',
'Lead 8 (brass + lead)',
'Pad 1 (new age)',
'Pad 2 (warm)',
'Pad 3 (polysynth)',
'Pad 4 (choir)',
'Pad 5 (bowed)',
'Pad 6 (metallic)',
'Pad 7 (halo)',
'Pad 8 (sweep)',
'FX 1 (rain)',
'FX 2 (soundtrack)',
'FX 3 (crystal)',
'FX 4 (atmosphere)',
'FX 5 (brightness)',
'FX 6 (goblins)',
'FX 7 (echoes)',
'FX 8 (sci-fi)',
'Sitar',
'Banjo',
'Shamisen',
'Koto',
'Kalimba',
'Bagpipe',
'Fiddle',
'Shana',
'Tinkle Bell',
'Agogo',
'Steel Drums',
'Woodblock',
'Taiko Drum',
'Melodic Tom',
'Synth Drum',
'Reverse Cymbal',
'Guitar Fret Noise',
'Breath Noise',
'Seashore',
'Bird Tweet',
'Telephone Ring',
'Helicopter',
'Applause',
'Gunshot',
];
const picoAudio = new PicoAudio();
const synth=new Tone.Synth().toMaster();
let file1name="";
let parsedData ="";
let toneData = "";
let r1=[];
let r2=[];
let r3=[];
let r4=[];
let r5=[];
let r6=[];
let midiData = "";
let midi=0;
let midi0=0;
let stm=0;;
let channel0=0;
let sb1=0;
let h_from=0;
let h_to=0;
let r3w=[];
let vmn0=0;

let ppq=0;
let format1=0;
let bpm=0;
let bttl=0;
let ntvl=0;
let bttl2=0;
let ntvl2=0;
let eott0=0;

let tbpm1=[];
let wait1=0;
let time1=[];
let i=0;
let j=0;
let k=0;
let l=0;
let m=0;
let n=0;
let o=0;

let r3i0=0;
let r3i1=0;
let midi_max=21;
let midi_min=108;
let midi_min0=0;
let midi_max0=0;
let ch_max=-1;
let ch_num=0;
let ht1=2;

let x_ch1="";
let chr=[];
let ch0=0;
let ch1=0;
let trs1=0;
let trs2=0;
let fg_lr1=-1;
let prgrs1=0;
let p=0;
let p2=0;
let n_id=1;

let kx0=0;
let kx1=0;
let kx2=0;
let kx3=0;
let kx4=0;
let kx5=0;
let kx6=0;
let kx7=0;
let kx8=0;
let kx9=0;
let kx10=0;
let kx11=0;
let kxttl=0;
let tone_ks=0;
let midi_ks=0;
let keyrp10_0=[];
let keyrp10_1=[];
let keyrp10_2=[];
let keyrp10_3=[];
let keyrp10_4=[];
let keyrp10_5=[];
let keyrp100_1=[];
let keyrp100_2=[];
let keyrp100_3=[];
let keyrp100_4=[];
let tfmjr0=0;
let tfmjr7=0;
let tfmnr0=0;
let tfmnr7=0;
let tfmjr07=0;
let tfmnr07=0;
let tfmjr_mnr=0;
let mslbl0=0;
let msr_from=0;
let msr_to=0;
let tk_from=0;
let tk_to=0;
let w0=0;
let w1=0;
let num0=0;
let num1=0;
let num2=0;
let num3=0;
let num4=0;
let lyrict0="";
let lyricr0=[];
let lyricr1=[];
let dtflg0=0;
let trln0=0;
let trdt0=0;
let trtk0=0;
let trtk1=0;
let trnn0=0;
let trnnr0=[];
let trnnr1=[];
let trnn2=0;
let trtk2=0;
let gt=0;
let midid0="";
let midid1="";
let midit00=0;
let midit01=0;
let midit02=0;
let midit03=0;
let midit04=0;
let midit05=0;
let midit06=0;
let midit07=0;
let midit08=0;
let midit09=0;
let midit0a=0;
let midit0b=0;
let midit0c=0;
let midit0d=0;
let midit0e=0;
let midit0f=0;
let midit20=0;
let midit51=0;
let midit54=0;
let midit56=0;
let midit59=0;
let miditxt=0;

let newWin1="";
let newWin2="";
let newWin3="";

let tsv0=[];
let tsvi=[];
let tsvc=[];
let tsv1=[];
let tsv2=[];
let tsv3=[];
let tsv4=[];
let tsv5=[];
let tsv6=[];
let tsv7=[];
let tsv8=[];
let tsv9=[];
let tsvst0=0;
let szx=1200;
let szy=640;
let szk=900;
let mx=60;
let my=40;
let f0=[];
let f1=[];
let f2=[];
let f3=[];
let f4=[];
let f5=[];
let f6=[];
let f8=[];
let f9=[];
let f10=[];
let f11=[];
let f12=[];
let f13=[];
let f14=[];
let f15=[];
let f16=[];
let f17=[];
let f18=[];
let fc=[];
let fp=[];
let f100=[];
let f101=[];
let f110=[];
let f111=[];
let rst=0;
let n_idf=1;
let rf1=[];
let rf2=[];
let fg5vp=0;
let lcn=0;

let fg1v=document.form1.fg1.options[document.form1.fg1.options.selectedIndex].value;//H
let fg2v=document.form1.fg2.options[document.form1.fg2.options.selectedIndex].value;//L
let fg3v=document.form1.fg3.options[document.form1.fg3.options.selectedIndex].value;//X
let fg4v=document.form1.fg4.options[document.form1.fg4.options.selectedIndex].value;//C
let fg5v=Number(document.form1.fg5.options[document.form1.fg5.options.selectedIndex].value)+6;//N
let fg6v=Number(document.form1.fg6.options[document.form1.fg6.options.selectedIndex].value)+2;//n
let fg7v=2**document.form1.fg7.options[document.form1.fg7.options.selectedIndex].value;//r
let fg8v=2**document.form1.fg8.options[document.form1.fg8.options.selectedIndex].value;//R


var obj1=document.getElementById("selfile1");
obj1.addEventListener("change", function(evt){
var file1=evt.target.files[0];
file1name = file1.name.split('.')[0];
var reader1=new FileReader();
reader1.readAsArrayBuffer(file1);
reader1.onload=function(ev){
picoAudio.init(); 
midiData = new Uint8Array(reader1.result);
parsedData = picoAudio.parseSMF(midiData);
picoAudio.setData(parsedData);
eott0 = parsedData.songLength;
ppq = parsedData.header.resolution;
bttl = parsedData.beatTrack[0].value[0];
ntvl = parsedData.beatTrack[0].value[1];
bpm = Math.round(parsedData.tempoTrack[0].value);
document.form1.x_bpm.value=bpm;
document.getElementById("ts").innerHTML=bttl+"/"+ntvl;
if(Math.floor(picoAudio.getTime(eott0)%60)<10){
document.getElementById("pt").innerHTML=Math.floor(picoAudio.getTime(eott0)/60)+":0"+Math.floor(picoAudio.getTime(eott0)%60);
}else{
document.getElementById("pt").innerHTML=Math.floor(picoAudio.getTime(eott0)/60)+":"+Math.floor(picoAudio.getTime(eott0)%60);
}
document.getElementById("prgrs").innerHTML=prgrs1;

r1=[];
r2=[];
r3=[];
r4=[];
r5=[];
r6=[];

midi_max=21;
midi_min=108;
midi_min0=0;
midi_max0=0;
n_id=1;
ch_max=-1;
ch_num=0;

parsedData.channels.forEach(channel => { 
channel.notes.forEach(note => {
r1.push([note.pitch,note.start,note.stop,note.channel,n_id]);
n_id+=1;
r2.push(note.start);
r2.push(note.stop);
  if(Number(note.pitch)>Number(midi_max)){
  midi_max=note.pitch;
  }
  if(Number(note.pitch)<Number(midi_min)){
  midi_min=note.pitch;
  }
  if(note.channel>ch_max){
  ch_max=note.channel;
  ch_num+=1;
  r6.push([note.channel, note.instrument]);
  }
})
})

i=0;
j=0;

document.getElementById("channels").innerHTML=ch_num;

midi_min0=midi_min;
midi_max0=midi_max;

r2.sort(function(m,n){return m-n;});
if (r2[0]<ppq*4/ntvl){
	stm=1;
}else{
	stm=0;
}

document.form1.x_msrf.value=stm;
document.form1.x_msrt.value=Math.floor(eott0/ppq/bttl*ntvl/4);

let n=0;
for(let i=0;i<=r2.length;i++){
if(r2[i]<r2[i+1]){
r3.push([n,r2[i],r2[i+1]]);
n=n+1;
}
}
r2=[];

parsedData.tempoTrack.forEach(tempoTrack => { 
r4.push([tempoTrack.timing,tempoTrack.value]);
});

parsedData.beatTrack.forEach(beatTrack => { 
r5.push([beatTrack.timing,beatTrack.value[0],beatTrack.value[1]]);
});

top1();

}
},false);

var obj2=document.getElementById("selfile2");
obj2.addEventListener("change", function(evt){
tsv0=[];
tsvi=[];
tsvc=[];
tsv1=[];
tsv2=[];
tsv3=[];
tsv4=[];
tsv5=[];
tsv6=[];
tsv7=[];
tsv8=[];
tsv9=[];
tsvff=[];
tsvft=[];
tsvsd=[];
tsvdl=[];
tsvsc=[];

var file2=evt.target.files[0];
var reader2=new FileReader();
reader2.readAsText(file2,"shift_JIS");
reader2.onload=function(ev){
tsv0=reader2.result.split('\n');

for (i=0;i<tsv0.length;i++){
	if((tsv0[i].split('\t'))[0]=="A"){
		tsvi.push([(tsv0[i].split('\t'))[1]]);
		tsvc.push([(tsv0[i].split('\t'))[2]]);
	}else if((tsv0[i].split('\t'))[0]=="B"){
		tsvsc.push([(tsv0[i].split('\t'))[2]]);
	}else if((tsv0[i].split('\t'))[0]=="C"){
		tsvff.push([(tsv0[i].split('\t'))[1]]);
		tsvft.push([(tsv0[i].split('\t'))[2]]);
		tsvsd.push([(tsv0[i].split('\t'))[3]]);
		tsvdl.push([(tsv0[i].split('\t'))[4]]);
		tsvff.push([(tsv0[i].split('\t'))[2]]);
		tsvft.push([(tsv0[i].split('\t'))[1]]);
		tsvsd.push([-(tsv0[i].split('\t'))[3]]);
		tsvdl.push([(tsv0[i].split('\t'))[4]]);
	}else if((tsv0[i].split('\t'))[0]=="D"){
		tsv1.push([(tsv0[i].split('\t'))[2]]);
		tsv2.push([(tsv0[i].split('\t'))[3]]);
		tsv3.push([(tsv0[i].split('\t'))[4]]);
		tsv4.push([(tsv0[i].split('\t'))[5]]);
		tsv5.push([(tsv0[i].split('\t'))[6]]);
		tsv6.push([(tsv0[i].split('\t'))[7]]);
		tsv7.push([(tsv0[i].split('\t'))[8]]);
		tsv8.push([(tsv0[i].split('\t'))[9]]);
		tsv9.push([(tsv0[i].split('\t'))[10]]);
	}
}
tsvst0=1;

if(tsvi.length<9){
    document.getElementById("credit").innerHTML=
    tsvi[1]+" : "+tsvc[1]+
    "<br>"+tsvi[2]+" : "+tsvc[2]+
    "<br>"+tsvi[3]+" : <a href="+tsvc[3]+">"+tsvc[3]+"</a>"+
    "<br>"+tsvi[4]+" : "+tsvc[4]+
	"<br>"+tsvi[5]+" : <a href="+tsvc[5]+">"+tsvc[5]+"</a>"+
    "<br>"+tsvi[6]+" : "+tsvc[6]+
    "<br>"+tsvi[7]+" : "+tsvc[7]+
	"<br>&copy;2023-2025 <font face=\"Arial\"><font color=\"ff0000\">T</font><font color=\"ff7f00\">o</font><font color=\"ffff00\">y</font><font color=\"00ff00\">S</font><font color=\"00ffff\">c</font><font color=\"0000ff\">o</font><font color=\"ff00ff\">r</font><font color=\"ff007f\">e</font></font><font size=\"2\">&reg</font>"+
	"  <a href=\"https://www.toyscore.app\">https://www.toyscore.app</a>";
}else{
    document.getElementById("credit").innerHTML=
    tsvi[1]+" : "+tsvc[1]+
    "<br>"+tsvi[2]+" : "+tsvc[2]+
    "<br>"+tsvi[3]+" : <a href="+tsvc[3]+">"+tsvc[3]+"</a>"+
    "<br>"+tsvi[4]+" : "+tsvc[4]+
	"<br>"+tsvi[5]+" : <a href="+tsvc[5]+">"+tsvc[5]+"</a>"+
    "<br>"+tsvi[6]+" : "+tsvc[6]+
    "<br>"+tsvi[7]+" : "+tsvc[7]+
    "<br>"+tsvi[8]+" : <a href="+tsvc[8]+">"+tsvc[8]+"</a>"+
    "<br>"+tsvi[9]+" : "+tsvc[9]+
	"<br>"+tsvi[10]+" : <a href="+tsvc[10]+">"+tsvc[10]+"</a>"+
    "<br>"+tsvi[11]+" : "+tsvc[11]+
    "<br>"+tsvi[12]+" : "+tsvc[12]+
	"<br>&copy;2023-2025 <font face=\"Arial\"><font color=\"ff0000\">T</font><font color=\"ff7f00\">o</font><font color=\"ffff00\">y</font><font color=\"00ff00\">S</font><font color=\"00ffff\">c</font><font color=\"0000ff\">o</font><font color=\"ff00ff\">r</font><font color=\"ff007f\">e</font></font><font size=\"2\">&reg</font>"+
	"  <a href=\"https://www.toyscore.app\">https://www.toyscore.app</a>";
}


top1();

}//reader2
},false);//obj2

//scroll landscape
function scroll1(){
szx=1103;
szy=780;
szk=szx-2*mx;
canvas2.width = szx;
canvas2.height = szy;
ctx2.clearRect(0,0,1400,1400);
ctx2.lineWidth=1;
let kn=Number(midi_max)-Number(midi_min)+1;
let kw=szk/kn;

ctx2.fillStyle="black";
ctx2.font="15px Arial";
ctx2.fillText(file1name,0,15);

for(l=0;l<Number(kn);l++){
let k=Number(midi_min)+l;
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(mx+l*kw,my/2,kw,my/4);
ctx2.fillStyle=col[k%12];
ctx2.fillRect(mx+l*kw,my*3/4,kw,my/4);

if (k%12===1 || k%12===3 || k%12===6 || k%12===8 || k%12===10){
ctx2.fillStyle="lightgrey";
ctx2.fillRect(mx+l*kw,my,kw,szy-my);
}else if (k%12===0){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="blue";
ctx2.stroke();
}else if (k%12===5){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="red";
ctx2.stroke();
}
}

for(let m=0;m<eott0;m=m+ppq/ntvl*4){
if(m%(ppq*bttl/ntvl*4)===0 && m>=j && m<=(j+ht1*ppq*bttl/ntvl*4)){
let vmn0=m/ppq/bttl*ntvl/4+stm;
ctx2.beginPath();
ctx2.moveTo(0,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="red";
ctx2.stroke();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
ctx2.fillText(vmn0,0,my*1.6+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));

}else if(m%(ppq/ntvl*4)===0 && m>=j && m<=(j+ht1*ppq*bttl/ntvl*4)){
ctx2.beginPath();
ctx2.moveTo(mx,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="green";
ctx2.stroke();
}
}

for(i=0;i<r1.length;i++){
let [midi, start, stop, channel, n_id]=r1[i];
gt=stop-start;
if(start>=j && start<j+ht1*ppq*bttl/ntvl*4){
ctx2.fillStyle=col[midi%12];
ctx2.fillRect((midi-midi_min)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw,gt*(szy-2*my)/(ht1*bttl*ppq/ntvl*4));
ctx2.beginPath();
ctx2.arc((midi-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
ctx2.fillStyle=col3[channel];
ctx2.fill();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
if (document.form1.nl1.options[0].selected==true){
ctx2.fillText("",(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[1].selected==true){
ctx2.fillText(drms1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[2].selected==true){
ctx2.fillText(drmf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[3].selected==true){
ctx2.fillText(engs1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[4].selected==true){
ctx2.fillText(engf1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[5].selected==true){
ctx2.fillText(gers1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[6].selected==true){
ctx2.fillText(gerf1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[7].selected==true){
ctx2.fillText((midi%12).toString(12),(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[8].selected==true){
ctx2.fillText(midi.toString(12),(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[9].selected==true){
ctx2.fillText(midi,(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[10].selected==true){
ctx2.fillText(n_id,(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv finger numbers
}else if (document.form1.nl1.options[11].selected==true && tsv1[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv1[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv memos
}else if (document.form1.nl1.options[12].selected==true && tsv2[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv2[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics1
}else if (document.form1.nl1.options[13].selected==true && tsv5[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv5[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics2
}else if (document.form1.nl1.options[14].selected==true && tsv6[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv6[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics3
}else if (document.form1.nl1.options[15].selected==true && tsv7[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv7[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics4
}else if (document.form1.nl1.options[16].selected==true && tsv8[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv8[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics5
}else if (document.form1.nl1.options[17].selected==true && tsv9[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv9[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations left
if (tsv3[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv3[n_id-tsvst0+1], mx/2,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations right
if (tsv4[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv4[n_id-tsvst0+1], mx+szk,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}

}//if(100+stop>j..)
}//for(i=0;)

}

//scroll portrait
function scroll2(){
szx=780;
szy=1103;
szk=szx-2*mx;
canvas2.width = szx;
canvas2.height = szy;
ctx2.clearRect(0,0,1400,1400);
ctx2.lineWidth=1;
let kn=Number(midi_max)-Number(midi_min)+1;
let kw=szk/kn;

ctx2.fillStyle="black";
ctx2.font="15px Arial";
ctx2.fillText(file1name,0,15);

for(l=0;l<Number(kn);l++){
let k=Number(midi_min)+l;
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(mx+l*kw,my/2,kw,my/4);
ctx2.fillStyle=col[k%12];
ctx2.fillRect(mx+l*kw,my*3/4,kw,my/4);

if (k%12===1 || k%12===3 || k%12===6 || k%12===8 || k%12===10){
ctx2.fillStyle="lightgrey";
ctx2.fillRect(mx+l*kw,my,kw,szy-my);
}else if (k%12===0){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="blue";
ctx2.stroke();
}else if (k%12===5){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="red";
ctx2.stroke();
}
}


for(let m=0;m<eott0;m=m+ppq/ntvl*4){
if(m%(ppq*bttl/ntvl*4)===0 && m>=j && m<=(j+ht1*ppq*bttl/ntvl*4)){
let vmn0=m/ppq/bttl*ntvl/4+stm;
ctx2.beginPath();
ctx2.moveTo(0,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="red";
ctx2.stroke();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
ctx2.fillText(vmn0,0,my*1.6+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));

}else if(m%(ppq/ntvl*4)===0 && m>=j && m<=(j+ht1*ppq*bttl/ntvl*4)){
ctx2.beginPath();
ctx2.moveTo(mx,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="green";
ctx2.stroke();
}
}

for(i=0;i<r1.length;i++){
let [midi, start, stop, channel, n_id]=r1[i];
gt=stop-start;
if(start>=j && start<j+ht1*ppq*bttl/ntvl*4){
ctx2.fillStyle=col[midi%12];
ctx2.fillRect((midi-midi_min)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw,gt*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.beginPath();
ctx2.arc((midi-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
ctx2.fillStyle=col3[channel];
ctx2.fill();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
if (document.form1.nl1.options[0].selected==true){
ctx2.fillText("",(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[1].selected==true){
ctx2.fillText(drms1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[2].selected==true){
ctx2.fillText(drmf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[3].selected==true){
ctx2.fillText(engs1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[4].selected==true){
ctx2.fillText(engf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[5].selected==true){
ctx2.fillText(gers1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[6].selected==true){
ctx2.fillText(gerf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[7].selected==true){
ctx2.fillText((midi%12).toString(12),(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[8].selected==true){
ctx2.fillText(midi,(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[9].selected==true){
ctx2.fillText(n_id,(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv finger numbers
}else if (document.form1.nl1.options[11].selected==true && tsv1[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv1[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv memos
}else if (document.form1.nl1.options[12].selected==true && tsv2[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv2[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics1
}else if (document.form1.nl1.options[13].selected==true && tsv5[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv5[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics2
}else if (document.form1.nl1.options[14].selected==true && tsv6[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv6[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics3
}else if (document.form1.nl1.options[15].selected==true && tsv7[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv7[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics4
}else if (document.form1.nl1.options[16].selected==true && tsv8[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv8[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics5
}else if (document.form1.nl1.options[17].selected==true && tsv9[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv9[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations left
if (tsv3[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv3[n_id-tsvst0+1], mx/2,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations right
if (tsv4[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv4[n_id-tsvst0+1], mx+szk,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}

}//if(100+stop>j..)
}//for(i=0;)

}

//still landscape
function still1(){
szx=1103;
szy=780;
szk=szx-2*mx;
canvas2.width = szx;
canvas2.height = szy;
ctx2.clearRect(0,0,1400,1400);
ctx2.lineWidth=1;
let kn=Number(midi_max)-Number(midi_min)+1;
let kw=szk/kn;

ctx2.fillStyle="black";
ctx2.font="15px Arial";
ctx2.fillText(file1name,0,15);

for(l=0;l<Number(kn);l++){
let k=Number(midi_min)+l;
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(mx+l*kw,my/2,kw,my/4);
ctx2.fillStyle=col[k%12];
ctx2.fillRect(mx+l*kw,my*3/4,kw,my/4);

if (k%12===1 || k%12===3 || k%12===6 || k%12===8 || k%12===10){
ctx2.fillStyle="lightgrey";
ctx2.fillRect(mx+l*kw,my,kw,szy-my);
}else if (k%12===0){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="blue";
ctx2.stroke();
}else if (k%12===5){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="red";
ctx2.stroke();
}

}

ctx2.beginPath();
ctx2.fillStyle="white";
ctx2.fillRect(mx,my/2+j%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4),mx+szk,my);

ctx2.beginPath();
ctx2.moveTo(0,szy);
ctx2.lineTo(mx+szk,szy);
ctx2.strokeStyle="red";
ctx2.stroke();

for(let m=0;m<eott0;m=m+ppq/ntvl*4){
if(m%(bttl*ppq/ntvl*4)===0 && m>=j && m<(j+ht1*bttl*ppq/ntvl*4)){
let vmn0=m/(bttl*ppq/ntvl*4)+stm;
ctx2.beginPath();
ctx2.moveTo(0,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="red";
ctx2.stroke();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
ctx2.fillText(vmn0,0,my*1.6+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));

}else if(m%(ppq/ntvl*4)===0 && m>=j && m<(j+ht1*bttl*ppq/ntvl*4)){
ctx2.beginPath();
ctx2.moveTo(mx,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="green";
ctx2.stroke();
}
}

for(i=0;i<r1.length;i++){
let [midi, start, stop, channel, n_id]=r1[i];
if(start<j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop<j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4)){
	gt=stop-start;
}else if(start<j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop>=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4)){
	gt=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4)-start;
}else if(start>=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop<j+ht1*bttl*ppq/ntvl*3){
	gt=stop-start;
}else if(start>=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop>=j+ht1*bttl*ppq/ntvl*3){
	gt=j+ht1*bttl*ppq/ntvl*3-start;
}

if(start>=j && start<j+ht1*bttl*ppq/ntvl*3){
ctx2.fillStyle=col[midi%12];
ctx2.fillRect((midi-midi_min)*kw+mx,my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw,gt*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.beginPath();
ctx2.arc((midi-midi_min+0.5)*kw+mx,my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
ctx2.fillStyle=col3[channel];
ctx2.fill();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
if (document.form1.nl1.options[0].selected==true){
ctx2.fillText("",(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[1].selected==true){
ctx2.fillText(drms1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[2].selected==true){
ctx2.fillText(drmf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[3].selected==true){
ctx2.fillText(engs1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[4].selected==true){
ctx2.fillText(engf1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[5].selected==true){
ctx2.fillText(gers1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[6].selected==true){
ctx2.fillText(gerf1[midi%12],(midi-midi_min+0.1)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[7].selected==true){
ctx2.fillText((midi%12).toString(12),(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[8].selected==true){
ctx2.fillText(midi.toString(12),(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[9].selected==true){
ctx2.fillText(midi,(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[10].selected==true){
ctx2.fillText(n_id,(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv finger number
}else if (document.form1.nl1.options[11].selected==true && tsv1[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv1[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv memos
}else if (document.form1.nl1.options[12].selected==true && tsv2[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv2[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics1
}else if (document.form1.nl1.options[13].selected==true && tsv5[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv5[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics2
}else if (document.form1.nl1.options[14].selected==true && tsv6[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv6[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics3
}else if (document.form1.nl1.options[15].selected==true && tsv7[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv7[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics4
}else if (document.form1.nl1.options[16].selected==true && tsv8[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv8[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics5
}else if (document.form1.nl1.options[17].selected==true && tsv9[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv9[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations left
if (tsv3[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv3[n_id-tsvst0+1], mx/2,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations right
if (tsv4[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv4[n_id-tsvst0+1], mx+szk,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}

}//if(stop>j..)

}//for(i=0;)

}

//still portrait
function still2(){
szx=780;
szy=1103;
szk=szx-2*mx;
canvas2.width = szx;
canvas2.height = szy;
ctx2.clearRect(0,0,1400,1400);
ctx2.lineWidth=1;
let kn=Number(midi_max)-Number(midi_min)+1;
let kw=szk/kn;

ctx2.fillStyle="black";
ctx2.font="15px Arial";
ctx2.fillText(file1name,0,15);

for(l=0;l<Number(kn);l++){
let k=Number(midi_min)+l;
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(mx+l*kw,my/2,kw,my/4);
ctx2.fillStyle=col[k%12];
ctx2.fillRect(mx+l*kw,my*3/4,kw,my/4);

if (k%12===1 || k%12===3 || k%12===6 || k%12===8 || k%12===10){
ctx2.fillStyle="lightgrey";
ctx2.fillRect(mx+l*kw,my,kw,szy-my);
}else if (k%12===0){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="blue";
ctx2.stroke();
}else if (k%12===5){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,my/2);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="red";
ctx2.stroke();
}

}

ctx2.beginPath();
ctx2.fillStyle="white";
ctx2.fillRect(mx,my/2+j%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4),mx+szk,my);

ctx2.beginPath();
ctx2.moveTo(0,szy);
ctx2.lineTo(mx+szk,szy);
ctx2.strokeStyle="red";
ctx2.stroke();

for(let m=0;m<eott0;m=m+ppq/ntvl*4){
if(m%(bttl*ppq/ntvl*4)===0 && m>=j && m<(j+ht1*bttl*ppq/ntvl*4)){
let vmn0=m/(bttl*ppq/ntvl*4)+stm;
ctx2.beginPath();
ctx2.moveTo(0,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="red";
ctx2.stroke();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
ctx2.fillText(vmn0,0,my*1.6+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));

}else if(m%(ppq/ntvl*4)===0 && m>=j && m<(j+ht1*bttl*ppq/ntvl*4)){
ctx2.beginPath();
ctx2.moveTo(mx,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+m%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="green";
ctx2.stroke();
}
}


for(i=0;i<r1.length;i++){
let [midi, start, stop, channel, n_id]=r1[i];
if(start<j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop<j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4)){
	gt=stop-start;
}else if(start<j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop>=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4)){
	gt=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4)-start;
}else if(start>=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop<j+ht1*bttl*ppq/ntvl*3){
	gt=stop-start;
}else if(start>=j+ht1*bttl*ppq/ntvl*4-j%(ht1*bttl*ppq/ntvl*4) && stop>=j+ht1*bttl*ppq/ntvl*3){
	gt=j+ht1*bttl*ppq/ntvl*3-start;
}
if(start>=j && start<j+ht1*bttl*ppq/ntvl*3){
ctx2.fillStyle=col[midi%12];
ctx2.fillRect((midi-midi_min)*kw+mx,my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw,gt*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.beginPath();
ctx2.arc((midi-midi_min+0.5)*kw+mx,my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
ctx2.fillStyle=col3[channel];
ctx2.fill();
ctx2.fillStyle="black";
ctx2.font="25px Arial";
if (document.form1.nl1.options[0].selected==true){
ctx2.fillText("",(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[1].selected==true){
ctx2.fillText(drms1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[2].selected==true){
ctx2.fillText(drmf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[3].selected==true){
ctx2.fillText(engs1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[4].selected==true){
ctx2.fillText(engf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[5].selected==true){
ctx2.fillText(gers1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[6].selected==true){
ctx2.fillText(gerf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[7].selected==true){
ctx2.fillText((midi%12).toString(12),(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[8].selected==true){
ctx2.fillText(midi.toString(12),(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[9].selected==true){
ctx2.fillText(midi,(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}else if (document.form1.nl1.options[10].selected==true){
ctx2.fillText(n_id,(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv finger number
}else if (document.form1.nl1.options[11].selected==true && tsv1[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv1[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv memos
}else if (document.form1.nl1.options[12].selected==true && tsv2[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv2[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics1
}else if (document.form1.nl1.options[13].selected==true && tsv5[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv5[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics2
}else if (document.form1.nl1.options[14].selected==true && tsv6[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv6[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics3
}else if (document.form1.nl1.options[15].selected==true && tsv7[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv7[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics4
}else if (document.form1.nl1.options[16].selected==true && tsv8[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv8[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
//tsv Lyrics5
}else if (document.form1.nl1.options[17].selected==true && tsv9[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv9[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations left
if (tsv3[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv3[n_id-tsvst0+1], mx/2,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}
//tsv notations right
if (tsv4[n_id-tsvst0+1]!=undefined){
ctx2.fillText(tsv4[n_id-tsvst0+1], mx+szk,6/5*my+start%(ht1*bttl*ppq/ntvl*4)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
}

}//if(stop>j..)
}//for(i=0;)

}


const silent1= async () =>{

ctx2.font="100px Arial";

	for(i=3;i>=0;i--){
		ctx2.fillStyle="red";
		wait0=60000/Math.max(document.form1.x_bpm.value,30);
		await new Promise(r => timer=setTimeout(r,wait0));
		ctx2.fillText(i,0,150*(4-i));
	}

ctx2.font="25px Arial";
 
	for(let i=r3i0;i<r3.length;i++){
		
		r3i1=i;
		let [n,h_from,h_to]=r3[i]
		j=h_from;

		document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);
		document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4)+1);

		r3w=r3.find(function(value){
		return (j<=value[1]);
		});

		wait1=60000/document.form1.x_bpm.value*(r3w[2]-r3w[1])/ppq;

		if(document.form1.sv1.options[0].selected==true){
		scroll1();
		}else if(document.form1.sv1.options[1].selected==true){
		scroll2();
		}else if(document.form1.sv1.options[2].selected==true){
		still1();
		}else if(document.form1.sv1.options[3].selected==true){
		still2();
		}

		await new Promise(r => timer=setTimeout(r,wait1));

	}
}


function setbpm1(){
	document.form1.x_bpm.value=Number(document.form1.sbpm1.options[document.form1.sbpm1.options.selectedIndex].value);
}


function setmsr1(){
	document.form1.x_msr.value=Number(document.form1.smsr1.options[document.form1.smsr1.options.selectedIndex].value);
	msr1();
}


function pause1(){
picoAudio.init();
picoAudio.pause();
clearTimeout(timer);
r3i0=r3i1;
}


function msr1(){
j=(document.form1.x_msr.value-stm)*ppq*bttl/ntvl*4;

let r3x=r3.findLast(function(value){
return (j>=value[1])
});
r3i0=r3x[0];

time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];

document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}


function top1(){
r3i0=0;
j=0;
document.form1.x_msr.value=stm;

time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];
document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);
picoAudio.setData(parsedData);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}

function end1(){
j=Math.floor(eott0/(bttl*ppq/ntvl*4)-stm)*(bttl*ppq/ntvl*4);
document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4))+stm;

time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];
document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}

function reverse1(){
if(document.form1.x_msr.value-stm-1>=0){
j=(document.form1.x_msr.value-stm-1)*(bttl*ppq/ntvl*4);
document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4))+stm;
}else{
top1();	
}

let r3x=r3.findLast(function(value){
return (j>=value[1])
});
r3i0=r3x[0];
time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];
document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}

function forward1(){
if((document.form1.x_msr.value-stm+1)*(bttl*ppq/ntvl*4)<=eott0){
j=(document.form1.x_msr.value-stm+1)*(bttl*ppq/ntvl*4);
document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4))+stm;
}

let r3x=r3.findLast(function(value){
return (j>=value[1])
});
r3i0=r3x[0];
time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];
document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}


function reverses(){
if((document.form1.x_msr.value-stm-ht1)*(bttl*ppq/ntvl*4)>=0){
j=(document.form1.x_msr.value-stm-ht1)*(bttl*ppq/ntvl*4);
document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4))+stm;
}else{
top1();	
}
let r3x=r3.findLast(function(value){
return (j>=value[1])
});
r3i0=r3x[0];
time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];
document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}

function forwards(){
if((Number(document.form1.x_msr.value)-stm+ht1)*(bttl*ppq/ntvl*4)<=eott0){
j=(Number(document.form1.x_msr.value)-stm+ht1)*(bttl*ppq/ntvl*4);
document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4))+stm;
}else{
end1();	
}
let r3x=r3.findLast(function(value){
return (j>=value[1])
});
r3i0=r3x[0];
time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];
document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}


const play1= async () =>{
picoAudio.init();
picoAudio.play();
picoAudio.addEventListener('noteOn', (note) => {
j=note.start;

document.getElementById("prgrs").innerHTML=Math.round(j/eott0*100);
document.form1.x_msr.value=Math.floor(j/(bttl*ppq/ntvl*4)+1);

r3w=r3.find(function(value){
return (j<=value[1]);
});

tbpm1=r4.findLast(function(value){
return(j>=value[0]);
});

document.form1.x_bpm.value=Math.floor(tbpm1[1]);

time1=r5.findLast(function(value){
return(j>=value[0]);
});
document.getElementById("ts").innerHTML=time1[1]+"/"+time1[2];

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}

});


}


function touch_sound1(){
var state=true;
window.addEventListener('click',playSound);
window.addEventListener('touchend',offSound);

playSound(e);
offSound(e);
}

function playSound(e){
let kn=Number(midi_max)-Number(midi_min)+1;
let kw=Math.round(900/kn);

if(!state)return;
p=Math.round((e.offsetX-50)/kw)-2+Number(midi_min);
p2=engs1[p%12]+Math.floor(p/12-1);
if(e.offsetY>=0 && document.form1.sv1.options[5].selected==true){
synth.triggerAttackRelease(p2,'8n');
state=false;
}
}

function offSound(e){
synth.triggerRelease();
state=true;
}


function height1(){
ht1=Number(document.form1.hg1.options[document.form1.hg1.options.selectedIndex].value)+1;

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}


function transpose1(){

tr1v=Number(document.form1.tr1.options[document.form1.tr1.options.selectedIndex].value);
if (tr1v<13){
	trs1=tr1v;
}else{
	trs1=12-tr1v;
}

midi_min=Number(midi_min0)+Number(trs1);
midi_max=Number(midi_max0)+Number(trs1);
r1=[]
n_id=1;
parsedData.channels.forEach(channel => { 
channel.notes.forEach(note => { 
let trs2=Number(note.pitch)+Number(trs1);
r1.push([trs2,note.start,note.stop, note.channel,n_id]);
n_id=n_id+1;
});
});

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}


function channel1(){
x_ch1=document.form1.chn1.options[document.form1.chn1.options.selectedIndex].value;

tr1v=Number(document.form1.tr1.options[document.form1.tr1.options.selectedIndex].value);
if (tr1v<13){
	trs1=tr1v;
}else{
	trs1=12-tr1v;
}

r1=[];
n_id=1;

midi_min=108;
midi_max=21;
parsedData.channels.forEach(channel => { 
channel.notes.forEach(note => { 
	if (x_ch1=="16"){
	let trs2=Number(note.pitch)+Number(trs1);
	r1.push([trs2,note.start,note.stop,note.channel,n_id]);
	if(trs2>midi_max){
	midi_max=trs2;
	}
	if(trs2<midi_min){
	midi_min=trs2;
	}
	n_id+=1;
	}else{
	if(note.channel==x_ch1){
	let trs2=Number(note.pitch)+Number(trs1);
	r1.push([trs2,note.start,note.stop,note.channel,n_id]);
	if(trs2>midi_max){
	midi_max=trs2;
	}
	if(trs2<midi_min){
	midi_min=trs2;
	}
	}
	n_id+=1;
	}
});
});

if(document.form1.sv1.options[0].selected==true){
scroll1();
}else if(document.form1.sv1.options[1].selected==true){
scroll2();
}else if(document.form1.sv1.options[2].selected==true){
still1();
}else if(document.form1.sv1.options[3].selected==true){
still2();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}

}

function information1(){
window.name="openerWin";
newWin2=window.open();
newWin2.document.writeln ('<pre>Information<hr color="#ff0000"></font></pre>'.fontsize(6));
newWin2.document.writeln ('<pre><font color="#000080">MIDI Choose File     </font>Choose a Standard MIDI File (SMF). </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">TSV  Choose File     </font>Choose a tsv file for the midi file to show additional information as follows: </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">                     Credit, Fingering, Memo, Left notation, Right notation, Lyrics(1-5). </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">H                    </font>Select to change number of measures shown on the screen from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">T                    </font>Select to transpose key by the number from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Ch                   </font>Select the channel number from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">L                    </font>Select level to make fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">X                    </font>Select to exclude type of fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">C                    </font>Select number to match with previous fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">10                   </font>Filter 1st fingering number or 10 to free from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">20                   </font>Filter 2nd fingering number or 20 to free from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">30                   </font>Filter 3rd fingering number or 30 to free from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">40                   </font>Filter 4th fingering number or 40 to free from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">50                   </font>Filter 5th fingering number or 50 to free from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">N                    </font>Select number for population to make fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">n                    </font>Select number for sample to make fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">r                    </font>Select number for short rest to make fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">R                    </font>Select number for long rest to make fingering from the pulldown menu. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">M                    </font>Show the measure of the number in the text box. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">K                    </font>Estimate key between two measure numbers in the text boxes. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Left list box        </font>Select one to show on notes.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Right list box       </font>Select one to switch view or run a program.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">bpm                  </font>Scroll screen or move a horizontal line silently at the fixed BPM in the text box. </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Play                 </font>Play the song and scroll screen or move a horizontal line.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">||                   </font>Pause playing and scrolling screen or moving a horizontal line.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">|<                   </font>Show the first measure.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080"><<                   </font>Show the previous screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080"><                    </font>Show the previous measure.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">>                    </font>Show the next measure.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">>>                   </font>Show the next screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">>|                   </font>Show the last measure.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Scroll Landscape     </font>Setting to scroll landscape screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Scroll Portrait      </font>Setting to scroll portrait screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Still Landscape      </font>Setting to still landscape screen with a horisontal line move down.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Still Portrait       </font>Setting to still portrait screen with a horisontal line move down.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Color Sample         </font>Color sample to print and set on the keyboad.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Touch Sound          </font>Setting to play by touching screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Channel Colors       </font>Table of channel colors, channel numbers and instruments.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Key 10               </font>Estimate key of the song by time window 10%.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Key 20               </font>Estimate key of the song by time window 20%.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Key 25               </font>Estimate key of the song by time window 25%.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Information          </font>Information for this site.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Pythagorean Tuning   </font>Change screen to show animation for Pythagorean Tuning.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Just Intonation      </font>Change screen to show animation for Just Intonation.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">12 Equal Temperament </font>Change screen to show animation for 12 Equal Temperament.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Fingering Assistant  </font>It assists you to find fingering.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Fingering Recorder   </font>It records fingering automatically.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Fingering Downloader </font>Click to download fingering data.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">MIDI TSV Downloader  </font>Click to download MIDI and TSV files.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Cover Landscape      </font>Click to show cover landscape image.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">Cover Portrait       </font>Click to show cover portrait image.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">PL                   </font>Click to download pdf for landscape screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#006400">PP                   </font>Click to download pdf for portrait screen.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000000">MIDI                 </font>MIDI is a trademark of The MIDI Manufacturers Association Inc., resistered in countries </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000000">                     </font>worldwide and of the Association of Musical Electronics Industry resistered in Japan.</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Trademark            </font>Japan Trademark Resistration Number 6706042 for  <font face="Arial"><font color="ff0000">T</font><font color="ff7f00">o</font><font color="ffff00">y</font><font color="00ff00">S</font><font color="00ffff">c</font><font color="0000ff">o</font><font color="ff00ff">r</font><font color="ff007f">e</font></font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Patent               </font>Japan Patent Number 7685023 "Keyboad instrument learning materials, prgram and method" </font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre><font color="#000080">Contact              </font>toyscore2023@gmail.com</font></pre>'.fontsize(5));
newWin2.document.writeln ('<pre> </pre>');
newWin2.document.writeln ('<pre>Software Licenses<hr color="#ff0000"></font></pre>'.fontsize(6));
newWin2.document.writeln ('<pre> </pre>');
newWin2.document.writeln ('<pre>PicoAudio.js'.fontsize(5));
newWin2.document.writeln ('<pre>MIT License</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>Copyright (c) 2017-2021 cagpie / Shun Kobayashi (cagpie@gmail.com)</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>Permission is hereby granted, free of charge, to any person obtaining a copy</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>of this software and associated documentation files (the "Software"), to deal</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>in the Software without restriction, including without limitation the rights</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>copies of the Software, and to permit persons to whom the Software is</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>furnished to do so, subject to the following conditions:</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>The above copyright notice and this permission notice shall be included in all</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>copies or substantial portions of the Software.</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>SOFTWARE.</pre>'.fontsize(5));
newWin2.document.writeln ('<pre> </pre>');
newWin2.document.writeln ('<pre> Tonejs</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>[The MIT License](http://opensource.org/licenses/MIT)</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>Copyright  2016 Yotam Mann</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>Permission is hereby granted, free of charge, to any person obtaining a copy</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>of this software and associated documentation files (the "Software"), to deal</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>in the Software without restriction, including without limitation the rights</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>copies of the Software, and to permit persons to whom the Software is</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>furnished to do so, subject to the following conditions:</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>The above copyright notice and this permission notice shall be included in</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>all copies or substantial portions of the Software.</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>THE SOFTWARE.</pre>'.fontsize(5));
newWin2.document.writeln ('<pre> </pre>');
newWin2.document.writeln ('<pre>html2pdf'.fontsize(5));
newWin2.document.writeln ('<pre>The MIT License</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>Copyright (c) 2017-2019 Erik Koopmans <http://www.erik-koopmans.com/></pre>'.fontsize(5));
newWin2.document.writeln ('<pre> </pre>');
newWin2.document.writeln ('<pre>jsPDF'.fontsize(5));
newWin2.document.writeln ('<pre>Copyright (c) 2010-2021 James Hall, https://github.com/MrRio/jsPDF (c) 2015-2021 yWorks GmbH, https://www.yworks.com/</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</pre>'.fontsize(5));
newWin2.document.writeln ('<pre>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.'.fontsize(5));
newWin2.document.writeln ('<pre> </pre>');
newWin2.document.writeln ('<pre>html2canvas'.fontsize(5));
newWin2.document.writeln ('<pre>Created by Niklas von Hertzen. Licensed under the MIT License.</pre>'.fontsize(5));

}

async function download1(){
let files=(await(await fetch("./data/SongList.tsv")).text()).split('\n');
dlf0=[];
dlf1=[];
dlf2=[];
window.name="openerWin";
newWin1=window.open();
newWin1.document.writeln ('<pre>Download Files<hr color="#ff0000"></font></pre>'.fontsize(6));
newWin1.document.writeln ("<table border='1' width='400'><tr><th>Composer</th><th>Title</th><th>MIDI</th><th>TSV</th><th>PDF</th></tr>");
for(i=0;i<files.length;i++){
	dlf0.push([(files[i].split('\t'))[0]]);
	dlf1.push([(files[i].split('\t'))[1]]);
	dlf2.push([(files[i].split('\t'))[2]]);
	newWin1.document.writeln ("<td>",dlf0[i],"</td><td>",dlf1[i],"</td><td><a href='data/",dlf2[i],".mid' download>",dlf2[i],".mid</a></td><td><a href='data/",dlf2[i],".tsv' download>",dlf2[i],".tsv</a></td><td><a href='data/",dlf2[i],".pdf' download>",dlf2[i],".pdf</a></td></tr>");
}
newWin1.document.writeln ("</table>");
}


function downloadFile(fileName, urlData) {
var aLink = document.createElement('a');
var evt = document.createEvent("HTMLEvents");
evt.initEvent("click");
aLink.download = fileName;
aLink.href = urlData;
aLink.dispatchEvent(evt);
}


function index1(){
window.location.href="index.html"
}

function chord_pt(){
window.location.href="Chord_pt.html"
}

function chord_ji(){
window.location.href="Chord_ji.html"
}

function chord_12et(){
window.location.href="Chord_12et.html"
}

 // Define a function 'standardDeviation' to calculate the standard deviation of an array
 const standardDeviation = (arr, usePopulation = false) => {
  // Calculate the mean of the array
  const mean = arr.reduce((acc, val) => acc + val, 0) / arr.length;
  
  // Calculate the sum of squared differences from the mean
  const sumOfSquaredDifferences = arr.reduce((acc, val) => acc.concat((val - mean) ** 2), [])
                                      .reduce((acc, val) => acc + val, 0);
  
  // Calculate the standard deviation
  return Math.sqrt(sumOfSquaredDifferences / (arr.length - (usePopulation ? 0 : 1)));
};

const mstd = (p) => {
	let	s0=0;
	fg6v=Number(document.form1.fg6.value)+2;
	for (q=0;q<f100[p][2].length-fg6v+1;q++){
		s0=s0+standardDeviation(f100[p][2].slice(q, q+fg6v))
		};
	f101.push([f100[p][0],f100[p][1],f100[p][2],s0]);
}


function finger1(){


fc=[];
fp=[];

let fg5v=Number(document.form1.fg5.options[document.form1.fg5.options.selectedIndex].value)+6;//N
let fg5vp=n_idf+fg5v-1;//last position of N
let fg2v=document.form1.fg2.options[document.form1.fg2.options.selectedIndex].value;
let fg7v=2**document.form1.fg7.options[document.form1.fg7.options.selectedIndex].value;
let rst7=ppq*bttl/ntvl/fg7v;
let fg8v=2**document.form1.fg8.options[document.form1.fg8.options.selectedIndex].value;
let rst8=ppq*bttl/ntvl/fg8v;

x_ch1=document.form1.chn1.options[document.form1.chn1.options.selectedIndex].value;

for(i=0;i<r1.length;i++){
	let [midi1, start1, stop1, channel1, n_id1]=r1[i];
	if (i==0 && channel1==x_ch1 && n_id1>=n_idf && n_id1<=fg5vp){
			fp.push([midi1, start1, stop1, channel1, n_id1, 1]);
	}else if (i>0){
		let [midi0, start0, stop0, channel0, n_id0]=r1[i-1];
		if (channel0==x_ch1 && channel1==x_ch1 && n_id0+1==n_id1 && n_id1>=n_idf && n_id1<=fg5vp && start1-stop0<rst8){
			fp.push([midi1, start1, stop1, channel1, n_id1, 0]);
		}else if (channel0==x_ch1 && channel1==x_ch1 && n_id0+1==n_id1 && n_id1>=n_idf && n_id1<=fg5vp && start1-stop0>=rst8){
			fp.push([midi1, start1, stop1, channel1, n_id1, 1]);
		}
	}
}


for(i=0;i<r1.length;i++){
	let [midi, start, stop, channel, n_id]=r1[i];
	if (channel==x_ch1 && n_id==n_idf){
		fc.push([midi, n_id]);
	}
}


f0=[];
let cp0=0;
let cp1=0;

for (p=1;p<fp.length;p++){
	let [midi0, start0, stop0,channel0, n_id0]=fp[p-1];
	let [midi1, start1, stop1,channel1, n_id1]=fp[p];
	for(q=0;q<tsvsd.length;q++){
		if(document.form1.fg1.options[0].selected==true && 
		start1-stop0<rst7 &&
		tsvsd[q]==midi1-midi0 && 
		n_id0==n_id1-1 && 
		tsvdl[q]<=fg2v &&
		tsvff[q]!=tsvft[q]){
			cp0=Number(midi0)-Number(tsvsc[tsvff[q]]);
			cp1=Number(midi1)-Number(tsvsc[tsvft[q]]);
			f0.push([[n_id0,n_id1],[tsvff[q],tsvft[q]],[cp0,cp1],[midi0, midi1],[start0, stop1]]);
		}else if(document.form1.fg1.options[1].selected==true && 
		start1-stop0<rst7 &&
		tsvsd[q]==midi0-midi1 && 
		n_id0==n_id1-1 && 
		tsvdl[q]<=fg2v &&
		tsvff[q]!=tsvft[q]){
			cp0=Number(midi0)+Number(tsvsc[tsvff[q]]);
			cp1=Number(midi1)+Number(tsvsc[tsvft[q]]);
			f0.push([[n_id0,n_id1],[tsvff[q],tsvft[q]],[cp0,cp1],[midi0, midi1],[start0, stop1]]);
		}
	}
	if (start1-stop0>=rst7 && n_id0==n_id1-1){
		for(q=1;q<=5;q++){
			for (r=1;r<=5;r++){
				if(document.form1.fg1.options[0].selected==true){
					cp0=Number(midi0)-Number(tsvsc[q]);
					cp1=Number(midi1)-Number(tsvsc[r]);
					f0.push([[n_id0,n_id1],[q,r],[cp0,cp1],[midi0, midi1],[start0, stop1]]);
				}else if(document.form1.fg1.options[1].selected==true){
					cp0=Number(midi0)+Number(tsvsc[q]);
					cp1=Number(midi1)+Number(tsvsc[r]);
					f0.push([[n_id0,n_id1],[q,r],[cp0,cp1],[midi0, midi1],[start0, stop1]]);
				}
			}
		}
	}
}

f1=[];


if(f0.length>0 && fp.length>1){
	for (p=0;p<f0.length;p++){
		let [[nf0, nt0], 
			 [ff0, ft0], 
			 [cf0, ct0],
			 [midif0, midit0],
			 [tf0, tt0]]=f0[p];
		if (document.form1.fg3.options[0].selected==true){
			f1.push([[nf0, nt0], 
			[ff0, ft0], 
			[cf0, ct0],
			[tf0, tt0]]);
		}else if(document.form1.fg3.options[1].selected==true &&
			(
				(
					(midif0%12==0||midif0%12==2||midif0%12==4||midif0%12==5||
					midif0%12==7||midif0%12==9||midif0%12==11
					) ||
					(
					(midif0%12==1||midif0%12==3||midif0%12==6||midif0%12==8||midif0%12==10
					) &&
					(ff0=="2"||ff0=="3"||ff0=="4"
					)
					)
				) &&
				(
					(midit0%12==0||midit0%12==2||midit0%12==4||
					midit0%12==5||midit0%12==7||midit0%12==9||midit0%12==11
					) ||
					(
					(midit0%12==1||midit0%12==3||midit0%12==6||midit0%12==8||midit0%12==10
					) &&
					(ft0=="2"||ft0=="3"||ft0=="4"
					)
					)
				)
			)
		){
			f1.push([[nf0, nt0], 
		 			 [ff0, ft0], 
					 [cf0, ct0],
					 [tf0, tt0]]);
		}
	}
}

let f1x0=[];

for (p=0;p<f1.length;p++){
	f1x0.push([[f1[p][0][0], f1[p][0][1]], 
			   ["0", f1[p][1][1]], 
			   ["0", f1[p][2][1]],
			   [f1[p][3][0], f1[p][3][1]]]);
}

let f1x1=[(new Set(f1x0))];


f2=[];
if(f1.length>0 && fp.length>2){
	for (p=0;p<f1.length;p++){
		let [[nf0, nt0], 
			 [ff0, ft0], 
			 [cf0, ct0],
			 [tf0, tt0]]=f1[p];
		for (q=0;q<f1.length;q++){
			let [[nf1, nt1], 
				 [ff1, ft1], 
				 [cf1, ct1], 
				 [tf1, tt1]]=f1[q];
			if(tf1-tt0<rst7 && nt0==nf1-0 && ft0==ff1-0 && nf0==fc[0][1] && ft0!=ft1){
				f2.push([[nf0, nt1], 
						 [ff0, ft0, ft1], 
						 [cf0, ct0, ct1], 
						 [tt1]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf1x, nt1x], 
				 [ff1x, ft1x], 
				 [cf1x, ct1x], 
				 [tf1x, tt1x]]=f1x1[r];
			if(tf1x-tt0>=rst7 && nt0==nf1x-0 && nf0==fc[0][1]){
				f2.push([[nf0, nt1x], 
						 [ff0, ft0, ft1x], 
						 [cf0, ct0, ct1x], 
						 [tt1x]]);
			}
		}
	}
}

f3=[];
if(f2.length>0 && fp.length>3){
	for (p=0;p<f2.length;p++){
		let [[nf0, nt1], 
			 [ff0, ft0, ft1], 
			 [cf0, ct0, ct1],
			 [tt1]]=f2[p];
		for (q=0;q<f1.length;q++){
			let [[nf2, nt2], 
				 [ff2, ft2], 
				 [cf2, ct2], 
				 [tf2, tt2]]=f1[q];
			if(tf2-tt1<rst7 && nt1==nf2-0 && ft1==ff2-0 && ft1!=ft2){
				f3.push([[nf0, nt2], 
						 [ff0, ft0, ft1, ft2], 
						 [cf0, ct0, ct1, ct2], 
						 [tt2]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf2x, nt2x], 
				 [ff2x, ft2x], 
				 [cf2x, ct2x], 
				 [tf2x, tt2x]]=f1x1[r];
			if(tf2x-tt1>=rst7 && nt1==nf2x-0 ){
				f3.push([[nf0, nt2x], 
				[ff0, ft0, ft1, ft2x], 
				[cf0, ct0, ct1, ct2x], 
				[tt2x]]);
			}
		}
	}
}

f4=[];
if(f3.length>0 && fp.length>4){
	for (p=0;p<f3.length;p++){
		let [[nf0, nt2], 
			 [ff0, ft0, ft1, ft2], 
			 [cf0, ct0, ct1, ct2],
			 [tt2]]=f3[p];
		for (q=0;q<f1.length;q++){
			let [[nf3, nt3], 
				 [ff3, ft3], 
				 [cf3, ct3], 
				 [tf3, tt3]]=f1[q];
			if(tf3-tt2<rst7 && nt2==nf3-0 && ft2==ff3-0 && ft2!=ft3){
				f4.push([[nf0, nt3], 
						 [ff0, ft0, ft1, ft2, ft3], 
						 [cf0, ct0, ct1, ct2, ct3], 
						 [tt3]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf3x, nt3x], 
				 [ff3x, ft3x], 
				 [cf3x, ct3x], 
				 [tf3x, tt3x]]=f1x1[r];
			if(tf3x-tt2>=rst7 && nt2==nf3x-0 ){
				f4.push([[nf0, nt3x], 
						 [ff0, ft0, ft1, ft2, ft3x], 
						 [cf0, ct0, ct1, ct2, ct3x], 
						 [tt3x]]);
			}
		}
	}
}

f5=[];
if(f4.length>0 && fp.length>5){
	for (p=0;p<f4.length;p++){
		let [[nf0, nt3], 
			 [ff0, ft0, ft1, ft2, ft3], 
			 [cf0, ct0, ct1, ct2, ct3],
			 [tt3]]=f4[p];
		for (q=0;q<f1.length;q++){
			let [[nf4, nt4], 
				 [ff4, ft4], 
				 [cf4, ct4], 
				 [tf4, tt4]]=f1[q];
			if(tf4-tt3<rst7 && nt3==nf4-0 && ft3==ff4-0 && ft3!=ft4){
				f5.push([[nf0, nt4], 
				[ff0, ft0, ft1, ft2, ft3, ft4], 
				[cf0, ct0, ct1, ct2, ct3, ct4], 
				[tt4]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf4x, nt4x], 
				 [ff4x, ft4x], 
				 [cf4x, ct4x], 
				 [tf4x, tt4x]]=f1x1[r];
			if(tf4x-tt3>=rst7 && nt3==nf4x-0 ){
				f5.push([[nf0, nt4x], 
				[ff0, ft0, ft1, ft2, ft3, ft4x], 
				[cf0, ct0, ct1, ct2, ct3, ct4x], 
				[tt4x]]);
			}
		}
	}
}

f6=[];
if(f5.length>0 && fp.length>6){
	for (p=0;p<f5.length;p++){
		let [[nf0, nt4], 
			 [ff0, ft0, ft1, ft2, ft3, ft4], 
			 [cf0, ct0, ct1, ct2, ct3, ct4],
			 [tt4]]=f5[p];
		for (q=0;q<f1.length;q++){
			let [[nf5, nt5], 
				 [ff5, ft5], 
				 [cf5, ct5], 
				 [tf5, tt5]]=f1[q];
			if(tf5-tt4<rst7 && nt4==nf5-0 && ft4==ff5-0 && ft4!=ft5){
				f6.push([[nf0, nt5], 
						 [ff0, ft0, ft1, ft2, ft3, ft4, ft5], 
						 [cf0, ct0, ct1, ct2, ct3, ct4, ct5], 
						 [tt5]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf5x, nt5x], 
				 [ff5x, ft5x], 
				 [cf5x, ct5x], 
				 [tf5x, tt5x]]=f1x1[r];
			if(tf5x-tt4>=rst7 && nt4==nf5x-0 ){
				f6.push([[nf0, nt5x], 
						 [ff0, ft0, ft1, ft2, ft3, ft4, ft5x], 
						 [cf0, ct0, ct1, ct2, ct3, ct4, ct5x], 
						 [tt5x]]);
			}
		}
	}
}

f7=[];
if(f6.length>0 && fp.length>7){
	for (p=0;p<f6.length;p++){
		let [[nf0, nt5], 
			 [ff0, ft0, ft1, ft2, ft3, ft4, ft5], 
			 [cf0, ct0, ct1, ct2, ct3, ct4, ct5],
			 [tt5]]=f6[p];
		for (q=0;q<f1.length;q++){
			let [[nf6, nt6], 
				 [ff6, ft6], 
				 [cf6, ct6], 
				 [tf6, tt6]]=f1[q];
			if(tf6-tt5<rst7 && nt5==nf6-0 && ft5==ff6-0 && ft5!=ft6){
				f7.push([[nf0, nt6], 
						 [ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6], 
						 [cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6], 
						 [tt6]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf6x, nt6x], 
				 [ff6x, ft6x], 
				 [cf6x, ct6x], 
				 [tf6x, tt6x]]=f1x1[r];
			if(tf6x-tt5>=rst7 && nt5==nf6x-0 ){
				f7.push([[nf0, nt6x], 
						 [ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6x], 
						 [cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6x], 
						 [tt6x]]);
			}
		}
	}
}

f8=[];
if(f7.length>0 && fp.length>8){
	for (p=0;p<f7.length;p++){
		let [[nf0, nt6], 
		[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6], 
		[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6],
		[tt6]]=f7[p];
		for (q=0;q<f1.length;q++){
			let [[nf7, nt7], [ff7, ft7], [cf7, ct7], [tf7, tt7]]=f1[q];
			if(tf7-tt6<rst7 && nt6==nf7-0 && ft6==ff7-0 && ft6!=ft7){
				f8.push([[nf0, nt7], 
				[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7], 
				[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7], 
				[tt7]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf7x, nt7x], [ff7x, ft7x], [cf7x, ct7x], [tf7x, tt7x]]=f1x1[r];
			if(tf7x-tt6>=rst7 && nt6==nf7x-0 ){
				f8.push([[nf0, nt7x], 
				[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7x], 
				[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7x], 
				[tt7x]]);
			}
		}
	}
}

f9=[];
if(f8.length>0 && fp.length>9){
	for (p=0;p<f8.length;p++){
		let [[nf0, nt7], 
		[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7], 
		[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7],
		[tt7]]=f8[p];
		for (q=0;q<f1.length;q++){
			let [[nf8, nt8], [ff8, ft8], [cf8, ct8], [tf8, tt8]]=f1[q];
			if(tf8-tt7<rst7 && nt7==nf8-0 && ft7==ff8-0 && ft7!=ft8){
				f9.push([[nf0, nt8], 
				[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7, ft8], 
				[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7, ct8], 
				[tt8]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf8x, nt8x], [ff8x, ft8x], [cf8x, ct8x], [tf8x, tt8x]]=f1x1[r];
			if(tf8x-tt7>=rst7 && nt7==nf8x-0 ){
				f9.push([[nf0, nt8x], 
				[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7, ft8x], 
				[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7, ct8x], 
				[tt8x]]);
			}
		}
	}
}

f10=[];
if(f9.length>0 && fp.length>10){
	for (p=0;p<f9.length;p++){
		let [[nf0, nt8], 
		[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7, ft8], 
		[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7, ct8],
		[tt8]]=f9[p];
		for (q=0;q<f1.length;q++){
			let [[nf9, nt9], [ff9, ft9], [cf9, ct9], [tf9, tt9]]=f1[q];
			if(tf9-tt8<rst7 && nt8==nf9-0 && ft8==ff9-0 && ft8!=ft9){
				f10.push([[nf0, nt9], 
				[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7, ft8, ft9], 
				[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7, ct8, ct9], 
				[tt9]]);
			}
		}
		for (r=0;r<f1x1.length;r++){
			let [[nf9x, nt9x], [ff9x, ft9x], [cf9x, ct9x], [tf9x, tt9x]]=f1x1[r];
			if(tf9x-tt8>=rst7 && nt8==nf9x-0 ){
				f10.push([[nf0, nt9x], 
				[ff0, ft0, ft1, ft2, ft3, ft4, ft5, ft6, ft7, ft8, ft9x], 
				[cf0, ct0, ct1, ct2, ct3, ct4, ct5, ct6, ct7, ct8, ct9x], 
				[tt9x]]);
			}
		}
	}
}



f100=[];

if (fp.length==1 ){
	f100.push([[f111[0][0]],[f111[0][1]],[f111[0][2]]]);
}else if (fp.length==2 && f1.length>0){
	f100=f1;
}else if (fp.length==3 && f2.length>0){
	f100=f2;
}else if (fp.length==4 && f3.length>0){
	f100=f3;
}else if (fp.length==5 && f4.length>0){
	f100=f4;
}else if (fp.length==6 && f5.length>0){
	f100=f5;
}else if (fp.length==7 && f6.length>0){
	f100=f6;
}else if (fp.length==8 && f7.length>0){
	f100=f7;
}else if (fp.length==9 && f8.length>0){
	f100=f8;
}else if (fp.length==10 && f9.length>0){
	f100=f9;
}else if (fp.length==11 && f10.length>0){
	f100=f10;
}

if (fp[0][5]==1){
	f111=[];
}

if (document.form1.fg4.options[0].selected==false && 
	f111.length>0
	){
		if(f111[0][1]=="1"){
			document.form1.fg41.options[1].selected=true;
		}else if(f111[0][1]=="2"){
			document.form1.fg41.options[2].selected=true;
		}else if(f111[0][1]=="3"){
			document.form1.fg41.options[3].selected=true;
		}else if(f111[0][1]=="4"){
			document.form1.fg41.options[4].selected=true;
		}else if(f111[0][1]=="5"){
			document.form1.fg41.options[5].selected=true;
		}
		if(f111.length<2){
			document.form1.fg42.options[0].selected=true;
		}else if(f111[1][1]=="1"){
			document.form1.fg42.options[1].selected=true;
		}else if(f111[1][1]=="2"){
			document.form1.fg42.options[2].selected=true;
		}else if(f111[1][1]=="3"){
			document.form1.fg42.options[3].selected=true;
		}else if(f111[1][1]=="4"){
			document.form1.fg42.options[4].selected=true;
		}else if(f111[1][1]=="5"){
			document.form1.fg42.options[5].selected=true;
		}
		if(f111.length<3){
			document.form1.fg43.options[0].selected=true;
		}else if(f111[2][1]=="1"){
			document.form1.fg43.options[1].selected=true;
		}else if(f111[2][1]=="2"){
			document.form1.fg43.options[2].selected=true;
		}else if(f111[2][1]=="3"){
			document.form1.fg43.options[3].selected=true;
		}else if(f111[2][1]=="4"){
			document.form1.fg43.options[4].selected=true;
		}else if(f111[2][1]=="5"){
			document.form1.fg43.options[5].selected=true;
		}
		if(f111.length<4){
			document.form1.fg44.options[0].selected=true;
		}else if(f111[3][1]=="1"){
			document.form1.fg44.options[1].selected=true;
		}else if(f111[3][1]=="2"){
			document.form1.fg44.options[2].selected=true;
		}else if(f111[3][1]=="3"){
			document.form1.fg44.options[3].selected=true;
		}else if(f111[3][1]=="4"){
			document.form1.fg44.options[4].selected=true;
		}else if(f111[3][1]=="5"){
			document.form1.fg44.options[5].selected=true;
		}
		if(f111.length<5){
			document.form1.fg45.options[0].selected=true;
		}else if(f111[4][1]=="1"){
			document.form1.fg45.options[1].selected=true;
		}else if(f111[4][1]=="2"){
			document.form1.fg45.options[2].selected=true;
		}else if(f111[4][1]=="3"){
			document.form1.fg45.options[3].selected=true;
		}else if(f111[4][1]=="4"){
			document.form1.fg45.options[4].selected=true;
		}else if(f111[4][1]=="5"){
			document.form1.fg45.options[5].selected=true;
		}	
}


let fg41v=document.form1.fg41.options[document.form1.fg41.options.selectedIndex].value;
let fg42v=document.form1.fg42.options[document.form1.fg42.options.selectedIndex].value;
let fg43v=document.form1.fg43.options[document.form1.fg43.options.selectedIndex].value;
let fg44v=document.form1.fg44.options[document.form1.fg44.options.selectedIndex].value;
let fg45v=document.form1.fg45.options[document.form1.fg45.options.selectedIndex].value;

f101=[];


for (p=0;p<f100.length;p++){
		if (
		document.form1.fg41.options[0].selected==true &&
		document.form1.fg42.options[0].selected==true &&
		document.form1.fg43.options[0].selected==true &&
		document.form1.fg44.options[0].selected==true &&
		document.form1.fg45.options[0].selected==true) {
			mstd(p);
		}else if (((
		document.form1.fg41.options[0].selected==false &&
		document.form1.fg42.options[0].selected==true &&
		document.form1.fg43.options[0].selected==true &&
		document.form1.fg44.options[0].selected==true &&
		document.form1.fg45.options[0].selected==true) ||
		f111.length==1) &&
		f100[p][1][0]==fg41v){
			mstd(p);
		}else if (((
		document.form1.fg41.options[0].selected==false &&
		document.form1.fg42.options[0].selected==false &&
		document.form1.fg43.options[0].selected==true &&
		document.form1.fg44.options[0].selected==true &&
		document.form1.fg45.options[0].selected==true) ||
		f111.length==2) &&
		f100[p][1][0]==fg41v &&
		f100[p][1][1]==fg42v){
			mstd(p);
		}else if (((
		document.form1.fg41.options[0].selected==false &&
		document.form1.fg42.options[0].selected==false &&
		document.form1.fg43.options[0].selected==false &&
		document.form1.fg44.options[0].selected==true &&
		document.form1.fg45.options[0].selected==true ) ||
		f111.length==3) &&
		f100[p][1][0]==fg41v &&
		f100[p][1][1]==fg42v && 
		f100[p][1][2]==fg43v){
			mstd(p);
		}else if (((
		document.form1.fg41.options[0].selected==false &&
		document.form1.fg42.options[0].selected==false &&
		document.form1.fg43.options[0].selected==false &&
		document.form1.fg44.options[0].selected==false &&
		document.form1.fg45.options[0].selected==true) ||
		f111.length==4 ) &&
		f100[p][1][0]==fg41v && 
		f100[p][1][1]==fg42v && 
		f100[p][1][2]==fg43v && 
		f100[p][1][3]==fg44v){
			mstd(p);
		}else if (((
		document.form1.fg41.options[0].selected==false &&
		document.form1.fg42.options[0].selected==false &&
		document.form1.fg43.options[0].selected==false &&
		document.form1.fg44.options[0].selected==false &&
		document.form1.fg45.options[0].selected==false) ||
		f111.length==5 ) &&
		f100[p][1][0]==fg41v &&
		f100[p][1][1]==fg42v && 
		f100[p][1][2]==fg43v && 
		f100[p][1][3]==fg44v && 
		f100[p][1][4]==fg45v){
			mstd(p);
		}
}


if (f101.length==0){
	document.form1.fg41.options[0].selected=true;
	document.form1.fg42.options[0].selected=true;
	document.form1.fg43.options[0].selected=true;
	document.form1.fg44.options[0].selected=true;
	document.form1.fg45.options[0].selected=true;
		for (p=0;p<f100.length;p++){
			mstd(p);
		}
}	


f101.sort(function(a,b){return(a[3] - b[3]);});


for (p=0;p<fc.length;p++){
	f110.push(['\r\n'+fc[p][1],f101[0][1][p]]);
}

f111=[];

if (document.form1.fg4.options[0].selected==false){
	if (fc.length<fp.length){
		for (p=fc.length;p<fp.length;p++){
		f111.push([fp[p][4],f101[0][1][p],f101[0][2][p]]);
		}
	}
}



szx=1100;
szy=280;
szk=szx-2*mx;
canvas2.width = 1400;
canvas2.height = 620;
ctx2.clearRect(0,0,1400,1400);
ctx2.lineWidth=1;
let kn=Number(midi_max)-Number(midi_min)+1;
let kw=szk/kn;

for(l=0;l<Number(kn);l++){
let k=Number(midi_min)+l;
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(mx+l*kw,my/2,kw,my/4);
ctx2.fillStyle=col[k%12];
ctx2.fillRect(mx+l*kw,my*3/4,kw,my/4);

if (k%12===1 || k%12===3 || k%12===6 || k%12===8 || k%12===10){
ctx2.fillStyle="lightgrey";
ctx2.fillRect(mx+l*kw,my,kw,szy-my);
}else if (k%12===0){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,0);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="blue";
ctx2.stroke();
ctx2.fillStyle="black";
ctx2.font="20px Arial";
if (document.form1.nl1.options[9].selected==true){
ctx2.fillText(k,mx+l*kw,my/2);
}else if (document.form1.nl1.options[8].selected==true){
ctx2.fillText(k.toString(12),mx+l*kw,my/2);
}else {
ctx2.fillText("C"+(k/12-1),mx+l*kw,my/2);
}
}else if (k%12===5){
ctx2.beginPath();
ctx2.moveTo(mx+l*kw,0);
ctx2.lineTo(mx+l*kw,szy);
ctx2.strokeStyle="red";
ctx2.stroke();
}
}

for(let m=0;m<eott0;m=m+ppq/ntvl*4){
if(m%(ppq*bttl/ntvl*4)===0 && m>=j && m<(j+ht1*ppq*bttl/ntvl*4)){
let vmn0=m/ppq/bttl*ntvl/4+stm;
ctx2.beginPath();
ctx2.moveTo(0,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.moveTo(1130,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(1330,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="red";
ctx2.stroke();
ctx2.fillStyle="black";
ctx2.font="20px Arial";
ctx2.fillText(vmn0,0,my*1.6+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));

}else if(m%(ppq/ntvl*4)===0 && m>=j && m<=(j+ht1*ppq*bttl/ntvl*4)){
ctx2.beginPath();
ctx2.moveTo(mx,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(mx+szk,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.moveTo(1130,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.lineTo(1330,my+(m-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
ctx2.strokeStyle="green";
ctx2.stroke();
}
}

for (i=1;i<=5;i++){
ctx2.beginPath();
ctx2.moveTo(1080+50*i,40);
ctx2.lineTo(1080+50*i,szy);
ctx2.strokeStyle="blue";
	if (document.form1.fg1.options[0].selected==true){
		ctx2.stroke();
		ctx2.fillText(i,1073+50*i,25);
	}else if (document.form1.fg1.options[1].selected==true){
		ctx2.stroke();
		ctx2.fillText(6-i,1073+50*i,25);
	}
}


for (i=0;i<=1;i++){
ctx2.beginPath();
ctx2.moveTo(1130,40+(szy-40)*i);
ctx2.lineTo(1330,40+(szy-40)*i);
ctx2.strokeStyle="blue";
ctx2.stroke();
}

for (p=0;p<f101.length;p++){
		if (p<9){
			ctx2.fillText(p+1,13,340+30*p);
			}else{
			ctx2.fillText(p+1,0,340+30*p);
			}
			for (q=0;q<fp.length;q++){
				ctx2.fillText(f101[p][1][q],180+50*q,340+30*p);
				}
		
		ctx2.fillText((f101[p][3]).toFixed(2),60,340+30*p);
	}
	ctx2.fillStyle="black";
	ctx2.fillText("No.",0,310);
	ctx2.fillText("S.mstd",60,310);
	ctx2.beginPath();
	if(Number(document.form1.fg4.options[document.form1.fg4.options.selectedIndex].value)>0){
		ctx2.moveTo(175+50*fc.length,szy);
		ctx2.lineTo(175+50*fc.length,615);
		ctx2.strokeStyle="blue";
		ctx2.stroke();
	}
	for(i=0;i<11;i++){
	ctx2.beginPath();
	ctx2.moveTo(0,315+30*i);
	ctx2.lineTo(180+50*fp.length,315+30*i);
	ctx2.strokeStyle=col[i];
	ctx2.stroke();
	}
	for(i=0;i<fp.length;i++){
		ctx2.fillText(fp[i][4],180+50*i,310);
		let [midi, start, stop, channel, n_id]=fp[i];
		gt=stop-start;
			if(start>=j && start<j+ht1*ppq*bttl){
				ctx2.fillStyle=col[midi%12];
				ctx2.fillRect((midi-midi_min)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw,gt*(szy-2*my)/(ht1*bttl*ppq/ntvl*4));
				ctx2.beginPath();
				ctx2.arc((midi-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
				ctx2.fillStyle=col3[channel];
				ctx2.fill();
				ctx2.fillStyle="black";
				if (document.form1.nl1.options[0].selected==true){
					ctx2.fillText("",(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[1].selected==true){
					ctx2.fillText(drms1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[2].selected==true){
					ctx2.fillText(drmf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[3].selected==true){
					ctx2.fillText(engs1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[4].selected==true){
					ctx2.fillText(engf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[5].selected==true){
					ctx2.fillText(gers1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[6].selected==true){
					ctx2.fillText(gerf1[midi%12],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[7].selected==true){
					ctx2.fillText((midi%12).toString(12),(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[8].selected==true){
					ctx2.fillText(midi.toString(12),(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[9].selected==true){
					ctx2.fillText(midi,(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[10].selected==true){
					ctx2.fillText(n_id,(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv finger numbers
				}else if (document.form1.nl1.options[11].selected==true && tsv1[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv1[n_id-tsvst0+1],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv memos
				}else if (document.form1.nl1.options[12].selected==true && tsv2[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv2[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv Lyrics1
				}else if (document.form1.nl1.options[13].selected==true && tsv5[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv5[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv Lyrics2
				}else if (document.form1.nl1.options[14].selected==true && tsv6[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv6[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv Lyrics3
				}else if (document.form1.nl1.options[15].selected==true && tsv7[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv7[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv Lyrics4
				}else if (document.form1.nl1.options[16].selected==true && tsv8[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv8[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				//tsv Lyrics5
				}else if (document.form1.nl1.options[17].selected==true && tsv9[n_id-tsvst0+1]!=undefined){
					ctx2.fillText(tsv9[n_id-tsvst0+1],(midi-midi_min)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
				}else if (document.form1.nl1.options[18].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[0][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[0][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[0][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[0][1][n_id-fc[0][1]],1073+Number(f101[0][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[0][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[0][1][n_id-fc[0][1]],1073+(6-Number(f101[0][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[19].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[1][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[1][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[1][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[1][1][n_id-fc[0][1]],1073+Number(f101[1][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[1][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[1][1][n_id-fc[0][1]],1073+(6-Number(f101[1][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[20].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[2][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[2][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[2][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[2][1][n_id-fc[0][1]],1073+Number(f101[2][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[2][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[2][1][n_id-fc[0][1]],1073+(6-Number(f101[2][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[21].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[3][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[3][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[3][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[3][1][n_id-fc[0][1]],1073+Number(f101[3][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[3][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[3][1][n_id-fc[0][1]],1073+(6-Number(f101[3][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[22].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[4][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[4][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[4][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[4][1][n_id-fc[0][1]],1073+Number(f101[4][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[4][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[4][1][n_id-fc[0][1]],1073+(6-Number(f101[4][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[23].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[5][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[5][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[5][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[5][1][n_id-fc[0][1]],1073+Number(f101[5][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[5][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[5][1][n_id-fc[0][1]],1073+(6-Number(f101[5][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[24].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[6][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[6][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[6][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[6][1][n_id-fc[0][1]],1073+Number(f101[6][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[6][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[6][1][n_id-fc[0][1]],1073+(6-Number(f101[6][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[25].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[7][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[7][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[7][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[7][1][n_id-fc[0][1]],1073+Number(f101[7][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[7][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[7][1][n_id-fc[0][1]],1073+(6-Number(f101[7][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[26].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[8][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[8][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[8][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[8][1][n_id-fc[0][1]],1073+Number(f101[8][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[8][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[8][1][n_id-fc[0][1]],1073+(6-Number(f101[8][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}else if (document.form1.nl1.options[27].selected==true){
						ctx2.beginPath();
						ctx2.arc((f101[9][2][n_id-fc[0][1]]-midi_min+0.5)*kw+mx,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/4,0,2*Math.PI,false);
						ctx2.fillStyle="red";
						ctx2.fill();
					ctx2.fillStyle="black";
					ctx2.fillText(f101[9][1][n_id-fc[0][1]],(midi-midi_min+0.2)*kw+mx,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					if (document.form1.fg1.options[0].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+Number(f101[9][1][n_id-fc[0][1]])*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[9][1][n_id-fc[0][1]],1073+Number(f101[9][1][n_id-fc[0][1]])*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}else if (document.form1.fg1.options[1].selected==true){
						ctx2.beginPath();
						ctx2.arc(1080+(6-Number(f101[9][1][n_id-fc[0][1]]))*50,my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4),kw/2,0,2*Math.PI,false);
						ctx2.fillStyle=col3[channel];
						ctx2.fill();
						ctx2.fillStyle="black";
						ctx2.fillText(f101[9][1][n_id-fc[0][1]],1073+(6-Number(f101[9][1][n_id-fc[0][1]]))*50,6/5*my+(start-j)*(szy-my)/(ht1*bttl*ppq/ntvl*4));
					}
				}
			}//if(start>=j && start<j+1*ppq*bttl)
	}//for(i=0;)
}


const finger2= async () =>{
time0=Date.now();
f110.push([['NoteID','Fingering','Minutes']]);
x_ch1=document.form1.chn1.options[document.form1.chn1.options.selectedIndex].value;
let fg1v=document.form1.fg1.options[document.form1.fg1.options.selectedIndex].value;//H
let fg2v=document.form1.fg2.options[document.form1.fg2.options.selectedIndex].value;//L
let fg3v=document.form1.fg3.options[document.form1.fg3.options.selectedIndex].value;//X
let fg4v=document.form1.fg4.options[document.form1.fg4.options.selectedIndex].value;//C
let fg5v=Number(document.form1.fg5.options[document.form1.fg5.options.selectedIndex].value)+6;//N
let fg6v=Number(document.form1.fg6.options[document.form1.fg6.options.selectedIndex].value)+2;//n
let fg7v=2**document.form1.fg7.options[document.form1.fg7.options.selectedIndex].value;//r
let fg8v=2**document.form1.fg8.options[document.form1.fg8.options.selectedIndex].value;//R

let rf1=[];

for(i=0;i<r1.length;i++){
	let [midi, start, stop, channel, n_id]=r1[i];
		rf1.push([midi, start, stop, channel, n_id]);		
}

n_idf=rf1[0][4];

for (s=0; s<rf1.length; s++){
	for (t=0;t<rf1.length;t++){
		let [midi, start, stop, channel, n_id]=rf1[t];
		if (n_id==n_idf){
			j=start;
		}
	}
	finger1();
	await new Promise(r => timer=setTimeout(r,1));
	n_idf+=1;
}

time1=Date.now();
timed=(time1-time0)/60000;
f110.push([['\r\n','',timed]]);

downloadFile(file1name+'_Ch'+(Number(x_ch1)+1)+'H'+fg1v+'L'+fg2v+'X'+fg3v+'C'+fg4v+'N'+fg5v+'n'+fg6v+'r'+fg7v+'R'+fg8v+'.csv', 'data:text/csv;charset=UTF-8,' + encodeURIComponent(f110));

}



const finger3= async () =>{
document.form1.fg4.options[0].selected=true;
x_ch1=document.form1.chn1.options[document.form1.chn1.options.selectedIndex].value;
let rf1=[];

for(i=0;i<r1.length;i++){
	let [midi, start, stop, channel, n_id]=r1[i];
		if (channel==x_ch1 ){
			rf1.push([midi, start, stop, channel, n_id]);
		}
}

for (p=0;p<rf1.length;p++){
	if (j==rf1[p][1]){
		n_idf=rf1[p][4];
	}else if(j==0){
		n_idf=rf1[0][4];
	}else if(j>rf1[p][1] && j<rf1[p+1][1]){
		n_idf=rf1[p][4];
	}
}

finger1();

}


function pdf_l(){
	if (document.form1.nl1.options[document.form1.nl1.options.selectedIndex].value<10){
		var nl1v='0'+document.form1.nl1.options[document.form1.nl1.options.selectedIndex].value;
	}else{
		var nl1v=document.form1.nl1.options[document.form1.nl1.options.selectedIndex].value;
	}
	if (document.form1.x_msr.value<10){
		var x_msrv='0'+document.form1.x_msr.value;
	}else{
		var x_msrv=document.form1.x_msr.value;
	}
	var element		= canvas2;
	var opt = {
	margin:       [0,20,0,0],
	filename:     file1name+'_Ch'+(Number(x_ch1)+1)+'NL'+nl1v+'M'+x_msrv+'_L.pdf',
	image:        { type: 'jpeg', quality: 0.95 },
	html2canvas:  { scale: 2 },
	jsPDF:        { unit: 'pt', format: [850,600], orientation: 'l' }
	};

	html2pdf().set(opt).from(element).save();
};

function pdf_p(){
	if (document.form1.nl1.options[document.form1.nl1.options.selectedIndex].value<10){
		var nl1v='0'+document.form1.nl1.options[document.form1.nl1.options.selectedIndex].value;
	}else{
		var nl1v=document.form1.nl1.options[document.form1.nl1.options.selectedIndex].value;
	}
	if (document.form1.x_msr.value<10){
		var x_msrv='0'+document.form1.x_msr.value;
	}else{
		var x_msrv=document.form1.x_msr.value;
	}
	var element		= canvas2;
	var opt = {
	margin:       [0,20,0,0],
	filename:     file1name+'_Ch'+(Number(x_ch1)+1)+'NL'+nl1v+'M'+x_msrv+'_P.pdf',
	image:        { type: 'jpeg', quality: 0.95 },
	html2canvas:  { scale: 2 },
	jsPDF:        { unit: 'pt', format: [600,850], orientation: 'p' }
	};

	html2pdf().set(opt).from(element).save();
};



function keyw1(){
canvas2.width = 1300;
canvas2.height = 1300;
ctx2.font="25px Arial";
ctx2.clearRect(0,0,1300,1300);
ctx2.lineWidth=1;
ctx2.fillStyle="black";
ctx2.fillText("Proportions of pitch classes in time windows and scatter plot of pitch classes and time",0,30);
ctx2.fillText("Note name #",0,60);
ctx2.fillText("Note name b",0,90);
ctx2.fillText("Time%",0,120);
ctx2.fillText("Measure",90,120);
ctx2.fillText("Total %",810,120);
ctx2.fillText("10",28,150);
ctx2.fillText("20",28,180);
ctx2.fillText("30",28,210);
ctx2.fillText("40",28,240);
ctx2.fillText("50",28,270);
ctx2.fillText("60",28,300);
ctx2.fillText("70",28,330);
ctx2.fillText("80",28,360);
ctx2.fillText("90",28,390);
ctx2.fillText("100",14,420);

for(i=0;i<=10;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/ppq/bttl*ntvl/4*i/10);
if(i>0 && i<=10){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,120+i*30);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,120+i*30);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,120+i*30);
	}else{
		ctx2.fillText(mslbl0,142,120+i*30);
	}
}

ctx2.beginPath();
ctx2.strokeStyle="gray";
ctx2.moveTo(0,120+i*30);
ctx2.lineTo(200,120+i*30);
ctx2.stroke();
ctx2.moveTo(800,120+i*30);
ctx2.lineTo(900,120+i*30);
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engs1[k],220+50*k,60);
ctx2.fillText(engf1[k],220+50*k,90);
ctx2.fillText((k%12).toString(12),220+50*k,120);
}

keyrp10_0=[];
for(let i=0;i<r1.length;i++){
let [midi, start]=r1[i];
ctx2.fillStyle=col[midi%12];
ctx2.fillRect(200+midi%12*50,120+start/eott0*300,50,1);
keyrp10_0.push([midi%12,Math.floor(start/eott0*10)]);
}

ctx2.fillStyle="black";
ctx2.fillText("Proportions of keys and the best relative keys in time windows",0,480);
ctx2.fillText("Major scale",0,510);
ctx2.fillText("Minor scale",0,540);
ctx2.fillText("Time%",0,570);
ctx2.fillText("Measure",90,570);
ctx2.fillText("Comments",810,570);
ctx2.fillText("10",28,600);
ctx2.fillText("20",28,630);
ctx2.fillText("30",28,660);
ctx2.fillText("40",28,690);
ctx2.fillText("50",28,720);
ctx2.fillText("60",28,750);
ctx2.fillText("70",28,780);
ctx2.fillText("80",28,810);
ctx2.fillText("90",28,840);
ctx2.fillText("100",14,870);

for(i=0;i<=10;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/ppq/bttl*ntvl/4*i/10);
if(i>=1 && i<=10){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,570+i*30);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,570+i*30);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,570+i*30);
	}else{
		ctx2.fillText(mslbl0,142,570+i*30);
	}
}
ctx2.beginPath();
ctx2.moveTo(0,570+i*30);
ctx2.lineTo(1050,570+i*30);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engf1[k],220+50*k,510);
ctx2.fillText(engMnr1[(k+9)%12],220+50*k,540);
}

keyrp10_1=[];
for(i=0;i<10;i++){
kx0=0;
kx1=0;
kx2=0;
kx3=0;
kx4=0;
kx5=0;
kx6=0;
kx7=0;
kx8=0;
kx9=0;
kx10=0;
kx11=0;
kxttl=0;
for(j=0;j<keyrp10_0.length;j++){
	if(i===keyrp10_0[j][1]){
		switch(Number(keyrp10_0[j][0])){
		case 0: kx0+=1;break;
		case 1: kx1+=1;break;
		case 2: kx2+=1;break;
		case 3: kx3+=1;break;
		case 4: kx4+=1;break;
		case 5: kx5+=1;break;
		case 6: kx6+=1;break;
		case 7: kx7+=1;break;
		case 8: kx8+=1;break;
		case 9: kx9+=1;break;
		case 10: kx10+=1;break;
		case 11: kx11+=1;break;
		}
		kxttl+=1;
	}
}
keyrp10_1.push([i, kx0, kx1, kx2, kx3, kx4, kx5, kx6, kx7, kx8, kx9, kx10, kx11, kxttl]);
}

w0=0;
for(i=0;i<10;i++){
	for(j=0;j<13;j++){
	w0=Math.round(keyrp10_1[i][j+1]/keyrp10_1[i][13]*100);
	if (j===12 && w0===100){
		ctx2.fillText(w0,810,150+30*i);
	}else if(w0===100){
		ctx2.fillText(w0,200+50*j,150+30*i);
	}else if(w0>=10){
		ctx2.fillText(w0,214+50*j,150+30*i);
	}else{
		ctx2.fillText(w0,228+50*j,150+30*i);
	}	
	}
}

keyrp10_2=[];
for(i=0;i<10;i++){
	for(j=0;j<12;j++){
		num0=0;
		for(k=0;k<12;k++){
			if(scaleMjr0.includes((12-j+k)%12)){
			num0=num0+Number(keyrp10_1[i][k+1]);
			}
		}
		keyrp10_2.push([i, j, num0,keyrp10_1[i][13]]);
	}
}


keyrp10_3=[];
for (i=0;i<10;i++){
		num1=0;
		num2=0;
		num3=0;
		num4=0;
	for (j=0;j<keyrp10_2.length;j++){
		if(i===keyrp10_2[j][0] && num2<keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4=0;
		}else if(i===keyrp10_2[j][0] && num2===keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4+=1;
		}
	}
	keyrp10_3.push([i,num1,num2,num3,num4]);
}

//mltiple max weights
for (i=0;i<10;i++){
	for(j=0;j<keyrp10_2.length;j++){
		if(i>0 && keyrp10_3[i][4]>0 && keyrp10_2[j][0]===i 
		 && keyrp10_2[j][2]===keyrp10_3[i][2] && keyrp10_2[j][1]===keyrp10_3[i-1][1] && keyrp10_3[i-1][4]===0){
		keyrp10_3[i].splice(1, 1, keyrp10_3[i-1][1]);
		keyrp10_3[i].splice(4, 1, 0);
		}else if(i<9 && keyrp10_3[i][4]>0 && keyrp10_2[j][0]===i 
		 && keyrp10_2[j][2]===keyrp10_3[i][2] && keyrp10_2[j][1]===keyrp10_3[i+1][1] && keyrp10_3[i+1][4]===0){
		keyrp10_3[i].splice(1, 1, keyrp10_3[i+1][1]);
		keyrp10_3[i].splice(4, 1, 0);
		}
	}
}

w1=0;
for(let i=0;i<10;i++){
	if(i===keyrp10_3[i][0]){
		if(keyrp10_3[i][4]>0){
		ctx2.fillStyle="black";
		ctx2.fillText(keyrp10_3[i][4]+1+" best pairs",810,600+30*i);
		}
		for(j=0;j<keyrp10_2.length;j++){
			if(i===keyrp10_2[j][0]){
				if(keyrp10_3[i][2]===keyrp10_2[j][2]){
				ctx2.fillStyle=col[keyrp10_2[j][1]];
				ctx2.fillRect(200+50*keyrp10_2[j][1],570+30*i,50,30);
				}
			ctx2.fillStyle="black";
			w1=Math.round(keyrp10_2[j][2]/keyrp10_2[j][3]*100)
				if (w1===100){
				ctx2.fillText(w1,200+50*keyrp10_2[j][1],600+30*i);
				}else if(w1>=10){
				ctx2.fillText(w1,214+50*keyrp10_2[j][1],600+30*i);
				}else{
				ctx2.fillText(w1,228+50*keyrp10_2[j][1],600+30*i);
				}
			}
		}
	}
}

ctx2.fillStyle="black";
ctx2.fillText("Comparing total proportions of the 1st and the 5th pitch classes of the best relative keys",0,930);
ctx2.fillText("Time%",0,960);
ctx2.fillText("Measure",90,960);
ctx2.fillText("10",28,990);
ctx2.fillText("20",28,1020);
ctx2.fillText("30",28,1050);
ctx2.fillText("40",28,1080);
ctx2.fillText("50",28,1110);
ctx2.fillText("60",28,1140);
ctx2.fillText("70",28,1170);
ctx2.fillText("80",28,1200);
ctx2.fillText("90",28,1230);
ctx2.fillText("100",14,1260);
ctx2.fillText("Conclusion",0,1290);
ctx2.fillText("Major 1st+5th",200,960);
ctx2.fillText("Minor 1st+5th",400,960);
ctx2.fillText("Major",600,960);
ctx2.fillText("Minor",700,960);
ctx2.fillText("Estimated Key",810,960);

for(i=0;i<=10;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/ppq/bttl*ntvl/4*i/10);
if(i>=1 && i<=10){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,960+i*30);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,960+i*30);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,960+i*30);
	}else{
		ctx2.fillText(mslbl0,142,960+i*30);
	}
}
ctx2.beginPath();
ctx2.moveTo(0,960+i*30);
ctx2.lineTo(1050,960+i*30);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

keyrp10_4=[];
for(i=0;i<keyrp10_3.length;i++){
for(j=0;j<keyrp10_1.length;j++){
if(i===keyrp10_1[j][0] && keyrp10_3[i][4]>0){
keyrp10_4.push("Unidentified");
}else if(i===keyrp10_1[j][0] && keyrp10_3[i][4]===0){
tfmjr0=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1]/keyrp10_1[j][13]*100);
tfmjr7=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]/keyrp10_1[j][13]*100);
tfmnr0=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1]/keyrp10_1[j][13]*100);
tfmnr7=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]/keyrp10_1[j][13]*100);
tfmjr07=((Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]))/keyrp10_1[j][13]*100).toFixed(2);
tfmnr07=((Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]))/keyrp10_1[j][13]*100).toFixed(2);
tfmjr_mnr=((
Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])
+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1])
-Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])
-Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1])
)/keyrp10_1[j][13]*100).toFixed(2);

ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[0])%12];
ctx2.fillRect(200,960+i*30,tfmjr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[4])%12];
ctx2.fillRect(200+tfmjr0,960+i*30,tfmjr7,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(400,960+i*30,tfmnr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[2])%12];
ctx2.fillRect(400+tfmnr0,960+i*30,tfmnr7,30);
ctx2.fillStyle="black";
if(tfmjr0>=10){
ctx2.fillText(tfmjr0,200,990+i*30);
}else{
ctx2.fillText("  " + tfmjr0,200,990+i*30);
}
if(tfmjr7>=10){
ctx2.fillText("+" + tfmjr7,230,990+i*30);
}else{
ctx2.fillText("+  " + tfmjr7,230,990+i*30);
}
if(tfmjr07>=10){
ctx2.fillText("= " + tfmjr07,280,990+i*30);
}else{
ctx2.fillText("=   " + tfmjr07,280,990+i*30);
}
if(tfmnr0>=10){
ctx2.fillText(tfmnr0,400,990+i*30);
}else{
ctx2.fillText("  " + tfmnr0,400,990+i*30);
}
if(tfmnr7>=10){
ctx2.fillText("+" + tfmnr7,430,990+i*30);
}else{
ctx2.fillText("+  " + tfmnr7,430,990+i*30);
}
if(tfmnr07>=10){
ctx2.fillText("= " + tfmnr07,480,990+i*30);
}else{
ctx2.fillText("=   " + tfmnr07,480,990+i*30);
}
if(tfmjr_mnr>0){
ctx2.fillStyle=col[keyrp10_3[i][1]];
ctx2.fillRect(600,960+i*30,tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(tfmjr_mnr>=10){
ctx2.fillText(tfmjr_mnr,600,990+i*30);
}else{
ctx2.fillText("  " + tfmjr_mnr,600,990+i*30);
}
keyrp10_4.push(engf1[keyrp10_3[i][1]] + " major");
}else if(tfmjr_mnr<0){
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(700,960+i*30,-tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(-tfmjr_mnr>=10){
ctx2.fillText(-tfmjr_mnr,700,990+i*30);
}else{
ctx2.fillText("  " + -tfmjr_mnr,700,990+i*30);
}
keyrp10_4.push(engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor");
}else if(tfmjr_mnr==0){
keyrp10_4.push(engf1[keyrp10_3[i][1]] + " major/" + engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor");
}//if(tfmjr_mnr)
}//if(keyrp10_3[i][4]===1){
}//for(j=0;j<keyrp10_1.length;j++){
}//for(i=0;i<keyrp10_3.length;i++){

//multiple best relative scales
ctx2.fillStyle="black";
for(i=0;i<10;i++){
	if(i>0 && keyrp10_4[i].includes("/") && keyrp10_4[i].includes(keyrp10_4[i-1]) && keyrp10_4[i]!=keyrp10_4[i-1]){
	keyrp10_4.splice(i,1,keyrp10_4[i-1]);			
	ctx2.fillText(keyrp10_4[i-1],810,960+(i+1)*30);
	}else if(i<9 && keyrp10_4[i].includes("/") && keyrp10_4[i].includes(keyrp10_4[i+1]) && keyrp10_4[i]!=keyrp10_4[i+1]){
	keyrp10_4.splice(i,1,keyrp10_4[i+1]);	
	ctx2.fillText(keyrp10_4[i+1],810,960+(i+1)*30);
	}else if(keyrp10_3[i][4]===0){
	ctx2.fillText(keyrp10_4[i],810,960+(i+1)*30);
	}
}

//weight double for first & last
keyrp10_4.push([keyrp10_4[0]]);
keyrp10_4.push([keyrp10_4[9]]);

keyrp10_4.sort();
keyrp10_5=[];
for(i=0;i<keyrp10_4.length;i++){
if(i===0 || keyrp10_4[i]!=keyrp10_4[i-1]){
keyrp10_5.push([keyrp10_4[i],1]);
}else{
keyrp10_5.push([keyrp10_4[i],keyrp10_5[i-1][1]+1]);
}//if()
}//for(i=0;i<keyrp10_4.length;i++){
keyrp10_5.sort(function( m, n){return n[1] - m[1];});
if(keyrp10_5[0][1]>keyrp10_5[1][1]){
ctx2.fillText(keyrp10_5[0][0] ,810,960+(11)*30);
}else{
ctx2.fillText("Unidentified" ,810,960+(11)*30);
}
}

function keyw3(){
canvas2.height = 1300;
ctx2.font="25px Arial";
ctx2.clearRect(0,0,1200,1300);
ctx2.lineWidth=1;
ctx2.fillStyle="black";
ctx2.fillText("Proportions of pitch classes in time windows and scatter plot of pitch classes and time",0,30);
ctx2.fillText("Note name #",0,60);
ctx2.fillText("Note name b",0,90);
ctx2.fillText("Time%",0,120);
ctx2.fillText("Measure",90,120);
ctx2.fillText("Total %",810,120);
ctx2.fillText("20",28,180);
ctx2.fillText("40",28,240);
ctx2.fillText("60",28,300);
ctx2.fillText("80",28,360);
ctx2.fillText("100",14,420);

for(i=0;i<=5;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/ppq/bttl*ntvl/4*i/5);
if(i>0 && i<=5){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,120+i*60);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,120+i*60);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,120+i*60);
	}else{
		ctx2.fillText(mslbl0,142,120+i*60);
	}
}

ctx2.beginPath();
ctx2.strokeStyle="gray";
ctx2.moveTo(0,120+i*60);
ctx2.lineTo(200,120+i*60);
ctx2.stroke();
ctx2.moveTo(800,120+i*60);
ctx2.lineTo(900,120+i*60);
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engs1[k],220+50*k,60);
ctx2.fillText(engf1[k],220+50*k,90);
ctx2.fillText((k%12).toString(12),220+50*k,120);
}

keyrp10_0=[];
for(let i=0;i<r1.length;i++){
let [midi, start]=r1[i];
ctx2.fillStyle=col[midi%12];
ctx2.fillRect(200+midi%12*50,120+start/eott0*300,50,1);
keyrp10_0.push([midi%12,Math.floor(start/eott0*5)]);
}

ctx2.fillStyle="black";
ctx2.fillText("Proportions of keys and the best relative keys in time windows",0,480);
ctx2.fillText("Major scale",0,510);
ctx2.fillText("Minor scale",0,540);
ctx2.fillText("Time%",0,570);
ctx2.fillText("Measure",90,570);
ctx2.fillText("Comments",810,570);
ctx2.fillText("20",28,630);
ctx2.fillText("40",28,690);
ctx2.fillText("60",28,750);
ctx2.fillText("80",28,810);
ctx2.fillText("100",14,870);

for(i=0;i<=5;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/(ppq*bttl/ntvl*4)*i/5);
if(i>=1 && i<=5){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,570+i*60);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,570+i*60);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,570+i*60);
	}else{
		ctx2.fillText(mslbl0,142,570+i*60);
	}
}
ctx2.beginPath();
ctx2.moveTo(0,570+i*60);
ctx2.lineTo(1050,570+i*60);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engf1[k],220+50*k,510);
ctx2.fillText(engMnr1[(k+9)%12],220+50*k,540);
}

keyrp10_1=[];
for(i=0;i<5;i++){
kx0=0;
kx1=0;
kx2=0;
kx3=0;
kx4=0;
kx5=0;
kx6=0;
kx7=0;
kx8=0;
kx9=0;
kx10=0;
kx11=0;
kxttl=0;
for(j=0;j<keyrp10_0.length;j++){
	if(i===keyrp10_0[j][1]){
		switch(Number(keyrp10_0[j][0])){
		case 0: kx0+=1;break;
		case 1: kx1+=1;break;
		case 2: kx2+=1;break;
		case 3: kx3+=1;break;
		case 4: kx4+=1;break;
		case 5: kx5+=1;break;
		case 6: kx6+=1;break;
		case 7: kx7+=1;break;
		case 8: kx8+=1;break;
		case 9: kx9+=1;break;
		case 10: kx10+=1;break;
		case 11: kx11+=1;break;
		}
		kxttl+=1;
	}
}
keyrp10_1.push([i, kx0, kx1, kx2, kx3, kx4, kx5, kx6, kx7, kx8, kx9, kx10, kx11, kxttl]);
}

w0=0;
for(i=0;i<5;i++){
	for(j=0;j<13;j++){
	w0=Math.round(keyrp10_1[i][j+1]/keyrp10_1[i][13]*100);
	if (j===12 && w0===100){
		ctx2.fillText(w0,810,180+60*i);
	}else if(w0===100){
		ctx2.fillText(w0,200+50*j,180+60*i);
	}else if(w0>=10){
		ctx2.fillText(w0,214+50*j,180+60*i);
	}else{
		ctx2.fillText(w0,228+50*j,180+60*i);
	}	
	}
}

keyrp10_2=[];
for(i=0;i<5;i++){
	for(j=0;j<12;j++){
		num0=0;
		for(k=0;k<12;k++){
			if(scaleMjr0.includes((12-j+k)%12)){
			num0=num0+Number(keyrp10_1[i][k+1]);
			}
		}
		keyrp10_2.push([i, j, num0,keyrp10_1[i][13]]);
	}
}

keyrp10_3=[];
for (i=0;i<5;i++){
		num1=0;
		num2=0;
		num3=0;
		num4=0;
	for (j=0;j<keyrp10_2.length;j++){
		if(i===keyrp10_2[j][0] && num2<keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4=0;
		}else if(i===keyrp10_2[j][0] && num2===keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4+=1;
		}
	}
	keyrp10_3.push([i,num1,num2,num3,num4]);
}

//mltiple max weights
for (i=0;i<5;i++){
	for(j=0;j<keyrp10_2.length;j++){
		if(i>0 && keyrp10_3[i][4]>0 && keyrp10_2[j][0]===i
		 && keyrp10_2[j][2]===keyrp10_3[i][2] && keyrp10_2[j][1]===keyrp10_3[i-1][1] && keyrp10_3[i-1][4]===0){
		keyrp10_3[i].splice(1, 1, keyrp10_3[i-1][1]);
		keyrp10_3[i].splice(4, 1, 0);
		}else if(i<4 && keyrp10_3[i][4]>0 && keyrp10_2[j][0]===i 
		 && keyrp10_2[j][2]===keyrp10_3[i][2] && keyrp10_2[j][1]===keyrp10_3[i+1][1] && keyrp10_3[i+1][4]===0){
		keyrp10_3[i].splice(1, 1, keyrp10_3[i+1][1]);
		keyrp10_3[i].splice(4, 1, 0);
		}
	}
}

w1=0;
for(let i=0;i<5;i++){
	if(i===keyrp10_3[i][0]){
		if(keyrp10_3[i][4]>0){
		ctx2.fillStyle="black";
		ctx2.fillText(keyrp10_3[i][4]+1+" best pairs",810,630+60*i);
		}
		for(j=0;j<keyrp10_2.length;j++){
			if(i===keyrp10_2[j][0]){
				if(keyrp10_3[i][2]===keyrp10_2[j][2]){
				ctx2.fillStyle=col[keyrp10_2[j][1]];
				ctx2.fillRect(200+50*keyrp10_2[j][1],600+60*i,50,30);
				}
			ctx2.fillStyle="black";
			w1=Math.round(keyrp10_2[j][2]/keyrp10_2[j][3]*100)
				if (w1===100){
				ctx2.fillText(w1,200+50*keyrp10_2[j][1],630+60*i);
				}else if(w1>=10){
				ctx2.fillText(w1,214+50*keyrp10_2[j][1],630+60*i);
				}else{
				ctx2.fillText(w1,228+50*keyrp10_2[j][1],630+60*i);
				}
			}
		}
	}
}

ctx2.fillStyle="black";
ctx2.fillText("Comparing total proportions of the 1st and the 5th pitch classes of the best relative keys",0,930);
ctx2.fillText("Time%",0,960);
ctx2.fillText("Measure",90,960);
ctx2.fillText("20",28,1020);
ctx2.fillText("40",28,1080);
ctx2.fillText("60",28,1140);
ctx2.fillText("80",28,1200);
ctx2.fillText("100",14,1260);
ctx2.fillText("Conclusion",0,1290);
ctx2.fillText("Major 1st+5th",200,960);
ctx2.fillText("Minor 1st+5th",400,960);
ctx2.fillText("Major",600,960);
ctx2.fillText("Minor",700,960);
ctx2.fillText("Estimated Key",810,960);

for(i=0;i<=5;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/(ppq*bttl/ntvl*4)*i/5);
if(i>=1 && i<=5){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,960+i*60);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,960+i*60);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,960+i*60);
	}else{
		ctx2.fillText(mslbl0,142,960+i*60);
	}
}
ctx2.beginPath();
ctx2.moveTo(0,960+i*60);
ctx2.lineTo(1050,960+i*60);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

keyrp10_4=[];
for(i=0;i<keyrp10_3.length;i++){
for(j=0;j<keyrp10_1.length;j++){
if(i===keyrp10_1[j][0] && keyrp10_3[i][4]>0){
keyrp10_4.push("Unidentified");
}else if(i===keyrp10_1[j][0] && keyrp10_3[i][4]===0){
tfmjr0=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1]/keyrp10_1[j][13]*100);
tfmjr7=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]/keyrp10_1[j][13]*100);
tfmnr0=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1]/keyrp10_1[j][13]*100);
tfmnr7=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]/keyrp10_1[j][13]*100);
tfmjr07=((Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]))/keyrp10_1[j][13]*100).toFixed(2);
tfmnr07=((Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]))/keyrp10_1[j][13]*100).toFixed(2);
tfmjr_mnr=((
Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])
+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1])
-Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])
-Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1])
)/keyrp10_1[j][13]*100).toFixed(2);

ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[0])%12];
ctx2.fillRect(200,990+i*60,tfmjr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[4])%12];
ctx2.fillRect(200+tfmjr0,990+i*60,tfmjr7,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(400,990+i*60,tfmnr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[2])%12];
ctx2.fillRect(400+tfmnr0,990+i*60,tfmnr7,30);
ctx2.fillStyle="black";
if(tfmjr0>=10){
ctx2.fillText(tfmjr0,200,1020+i*60);
}else{
ctx2.fillText("  " + tfmjr0,200,1020+i*60);
}
if(tfmjr7>=10){
ctx2.fillText("+" + tfmjr7,230,1020+i*60);
}else{
ctx2.fillText("+  " + tfmjr7,230,1020+i*60);
}
if(tfmjr07>=10){
ctx2.fillText("= " + tfmjr07,280,1020+i*60);
}else{
ctx2.fillText("=   " + tfmjr07,280,1020+i*60);
}
if(tfmnr0>=10){
ctx2.fillText(tfmnr0,400,1020+i*60);
}else{
ctx2.fillText("  " + tfmnr0,400,1020+i*60);
}
if(tfmnr7>=10){
ctx2.fillText("+" + tfmnr7,430,1020+i*60);
}else{
ctx2.fillText("+  " + tfmnr7,430,1020+i*60);
}
if(tfmnr07>=10){
ctx2.fillText("= " + tfmnr07,480,1020+i*60);
}else{
ctx2.fillText("=   " + tfmnr07,480,1020+i*60);
}
if(tfmjr_mnr>0){
ctx2.fillStyle=col[keyrp10_3[i][1]];
ctx2.fillRect(600,990+i*60,tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(tfmjr_mnr>=10){
ctx2.fillText(tfmjr_mnr,600,1020+i*60);
}else{
ctx2.fillText("  " + tfmjr_mnr,600,1020+i*60);
}
keyrp10_4.push(engf1[keyrp10_3[i][1]] + " major");
}else if(tfmjr_mnr<0){
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(700,990+i*60,-tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(-tfmjr_mnr>=10){
ctx2.fillText(-tfmjr_mnr,700,1020+i*60);
}else{
ctx2.fillText("  " + -tfmjr_mnr,700,1020+i*60);
}
keyrp10_4.push(engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor");
}else if(tfmjr_mnr==0){
keyrp10_4.push(engf1[keyrp10_3[i][1]] + " major/" + engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor");
}//if(tfmjr_mnr)
}//if(keyrp10_3[i][4]===1){
}//for(j=0;j<keyrp10_1.length;j++){
}//for(i=0;i<keyrp10_3.length;i++){

//multiple best relative scales
ctx2.fillStyle="black";
for(i=0;i<5;i++){
	if(i>0 && keyrp10_4[i].includes("/") && keyrp10_4[i].includes(keyrp10_4[i-1]) && keyrp10_4[i]!=keyrp10_4[i-1]){
	keyrp10_4.splice(i,1,keyrp10_4[i-1]);			
	ctx2.fillText(keyrp10_4[i-1],810,960+(i+1)*60);
	}else if(i<9 && keyrp10_4[i].includes("/") && keyrp10_4[i].includes(keyrp10_4[i+1]) && keyrp10_4[i]!=keyrp10_4[i+1]){
	keyrp10_4.splice(i,1,keyrp10_4[i+1]);	
	ctx2.fillText(keyrp10_4[i+1],810,960+(i+1)*60);
	}else if(keyrp10_3[i][4]===0){
	ctx2.fillText(keyrp10_4[i],810,960+(i+1)*60);
	}
}

//weight double for first & last
keyrp10_4.push([keyrp10_4[0]]);
keyrp10_4.push([keyrp10_4[4]]);

keyrp10_4.sort();
keyrp10_5=[];
for(i=0;i<keyrp10_4.length;i++){
if(i===0 || keyrp10_4[i]!=keyrp10_4[i-1]){
keyrp10_5.push([keyrp10_4[i],1]);
}else{
keyrp10_5.push([keyrp10_4[i],keyrp10_5[i-1][1]+1]);
}//if()
}//for(i=0;i<keyrp10_4.length;i++){
keyrp10_5.sort(function( m, n){return n[1] - m[1];});
if(keyrp10_5[0][1]>keyrp10_5[1][1]){
ctx2.fillText(keyrp10_5[0][0] ,810,960+(11)*30);
}else{
ctx2.fillText("Unidentified" ,810,960+(11)*30);
}

}

function keyw4(){
canvas2.height = 1300;
ctx2.font="25px Arial";
ctx2.clearRect(0,0,1200,1300);
ctx2.lineWidth=1;
ctx2.fillStyle="black";
ctx2.fillText("Proportions of pitch classes in time windows and scatter plot of pitch classes and time",0,30);
ctx2.fillText("Note name #",0,60);
ctx2.fillText("Note name b",0,90);
ctx2.fillText("Time%",0,120);
ctx2.fillText("Measure",90,120);
ctx2.fillText("Total %",810,120);
ctx2.fillText("25",28,120+300/4);
ctx2.fillText("50",28,270);
ctx2.fillText("75",28,120+300/4*3);
ctx2.fillText("100",14,420);

for(i=0;i<=4;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/ppq/bttl*ntvl/4*i/4);
if(i>0 && i<=4){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,120+i*75);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,120+i*75);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,120+i*75);
	}else{
		ctx2.fillText(mslbl0,142,120+i*75);
	}
}

ctx2.beginPath();
ctx2.strokeStyle="gray";
ctx2.moveTo(0,120+i*75);
ctx2.lineTo(200,120+i*75);
ctx2.stroke();
ctx2.moveTo(800,120+i*75);
ctx2.lineTo(900,120+i*75);
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engs1[k],220+50*k,60);
ctx2.fillText(engf1[k],220+50*k,90);
ctx2.fillText((k%12).toString(12),220+50*k,120);
}

keyrp10_0=[];
for(let i=0;i<r1.length;i++){
let [midi, start]=r1[i];
ctx2.fillStyle=col[midi%12];
ctx2.fillRect(200+midi%12*50,120+start/eott0*300,50,1);
keyrp10_0.push([midi%12,Math.floor(start/eott0*4)]);
}

ctx2.fillStyle="black";
ctx2.fillText("Proportions of keys and the best relative keys in time windows",0,480);
ctx2.fillText("Major scale",0,510);
ctx2.fillText("Minor scale",0,540);
ctx2.fillText("Time%",0,570);
ctx2.fillText("Measure",90,570);
ctx2.fillText("Comments",810,570);
ctx2.fillText("25",28,645);
ctx2.fillText("50",28,720);
ctx2.fillText("75",28,795);
ctx2.fillText("100",14,870);

for(i=0;i<=4;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/(ppq*bttl/ntvl*4)*i/4);
if(i>=1 && i<=4){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,570+i*75);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,570+i*75);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,570+i*75);
	}else{
		ctx2.fillText(mslbl0,142,570+i*75);
	}
}
ctx2.beginPath();
ctx2.moveTo(0,570+i*75);
ctx2.lineTo(1050,570+i*75);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engf1[k],220+50*k,510);
ctx2.fillText(engMnr1[(k+9)%12],220+50*k,540);
}

keyrp10_1=[];
for(i=0;i<4;i++){
kx0=0;
kx1=0;
kx2=0;
kx3=0;
kx4=0;
kx5=0;
kx6=0;
kx7=0;
kx8=0;
kx9=0;
kx10=0;
kx11=0;
kxttl=0;
for(j=0;j<keyrp10_0.length;j++){
	if(i===keyrp10_0[j][1]){
		switch(Number(keyrp10_0[j][0])){
		case 0: kx0+=1;break;
		case 1: kx1+=1;break;
		case 2: kx2+=1;break;
		case 3: kx3+=1;break;
		case 4: kx4+=1;break;
		case 5: kx5+=1;break;
		case 6: kx6+=1;break;
		case 7: kx7+=1;break;
		case 8: kx8+=1;break;
		case 9: kx9+=1;break;
		case 10: kx10+=1;break;
		case 11: kx11+=1;break;
		}
		kxttl+=1;
	}
}
keyrp10_1.push([i, kx0, kx1, kx2, kx3, kx4, kx5, kx6, kx7, kx8, kx9, kx10, kx11, kxttl]);
}

w0=0;
for(i=0;i<4;i++){
	for(j=0;j<13;j++){
	w0=Math.round(keyrp10_1[i][j+1]/keyrp10_1[i][13]*100);
	if (j===12 && w0===100){
		ctx2.fillText(w0,810,120+75*(i+1));
	}else if(w0===100){
		ctx2.fillText(w0,200+50*j,120+75*(i+1));
	}else if(w0>=10){
		ctx2.fillText(w0,214+50*j,120+75*(i+1));
	}else{
		ctx2.fillText(w0,228+50*j,120+75*(i+1));
	}	
	}
}

keyrp10_2=[];
for(i=0;i<4;i++){
	for(j=0;j<12;j++){
		num0=0;
		for(k=0;k<12;k++){
			if(scaleMjr0.includes((12-j+k)%12)){
			num0=num0+Number(keyrp10_1[i][k+1]);
			}
		}
		keyrp10_2.push([i, j, num0,keyrp10_1[i][13]]);
	}
}

keyrp10_3=[];
for (i=0;i<4;i++){
		num1=0;
		num2=0;
		num3=0;
		num4=0;
	for (j=0;j<keyrp10_2.length;j++){
		if(i===keyrp10_2[j][0] && num2<keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4=0;
		}else if(i===keyrp10_2[j][0] && num2===keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4+=1;
		}
	}
	keyrp10_3.push([i,num1,num2,num3,num4]);
}

//mltiple max weights
for (i=0;i<4;i++){
	for(j=0;j<keyrp10_2.length;j++){
		if(i>0 && keyrp10_3[i][4]>0 && keyrp10_2[j][0]===i 
		 && keyrp10_2[j][2]===keyrp10_3[i][2] && keyrp10_2[j][1]===keyrp10_3[i-1][1] && keyrp10_3[i-1][4]===0){
		keyrp10_3[i].splice(1, 1, keyrp10_3[i-1][1]);
		keyrp10_3[i].splice(4, 1, 0);
		}else if(i<3 && keyrp10_3[i][4]>0 && keyrp10_2[j][0]===i 
		 && keyrp10_2[j][2]===keyrp10_3[i][2] && keyrp10_2[j][1]===keyrp10_3[i+1][1] && keyrp10_3[i+1][4]===0){
		keyrp10_3[i].splice(1, 1, keyrp10_3[i+1][1]);
		keyrp10_3[i].splice(4, 1, 0);
		}
	}
}

w1=0;
for(let i=0;i<4;i++){
	if(i===keyrp10_3[i][0]){
		if(keyrp10_3[i][4]>0){
		ctx2.fillStyle="black";
		ctx2.fillText(keyrp10_3[i][4]+1+" best pairs",810,645+75*i);
		}
		for(j=0;j<keyrp10_2.length;j++){
			if(i===keyrp10_2[j][0]){
				if(keyrp10_3[i][2]===keyrp10_2[j][2]){
				ctx2.fillStyle=col[keyrp10_2[j][1]];
				ctx2.fillRect(200+50*keyrp10_2[j][1],615+75*i,50,30);
				}
			ctx2.fillStyle="black";
			w1=Math.round(keyrp10_2[j][2]/keyrp10_2[j][3]*100)
				if (w1===100){
				ctx2.fillText(w1,200+50*keyrp10_2[j][1],645+75*i);
				}else if(w1>=10){
				ctx2.fillText(w1,214+50*keyrp10_2[j][1],645+75*i);
				}else{
				ctx2.fillText(w1,228+50*keyrp10_2[j][1],645+75*i);
				}
			}
		}
	}
}

ctx2.fillStyle="black";
ctx2.fillText("Comparing total proportions of the 1st and the 5th pitch classes of the best relative keys",0,930);
ctx2.fillText("Time%",0,960);
ctx2.fillText("Measure",90,960);
ctx2.fillText("25",28,1035);
ctx2.fillText("50",28,1110);
ctx2.fillText("75",28,1185);
ctx2.fillText("100",14,1260);
ctx2.fillText("Conclusion",0,1290);
ctx2.fillText("Major 1st+5th",200,960);
ctx2.fillText("Minor 1st+5th",400,960);
ctx2.fillText("Major",600,960);
ctx2.fillText("Minor",700,960);
ctx2.fillText("Estimated Key",810,960);

for(i=0;i<=4;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/(ppq*bttl/ntvl*4)*i/4);
if(i>=1 && i<=4){
	if(mslbl0>=1000){
		ctx2.fillText(mslbl0,100,960+i*75);
	}else if(mslbl0>=100){
		ctx2.fillText(mslbl0,114,960+i*75);
	}else if(mslbl0>=10){
		ctx2.fillText(mslbl0,128,960+i*75);
	}else{
		ctx2.fillText(mslbl0,142,960+i*75);
	}
}
ctx2.beginPath();
ctx2.moveTo(0,960+i*75);
ctx2.lineTo(1050,960+i*75);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

keyrp10_4=[];
for(i=0;i<keyrp10_3.length;i++){
for(j=0;j<keyrp10_1.length;j++){
if(i===keyrp10_1[j][0] && keyrp10_3[i][4]>0){
keyrp10_4.push("Unidentified");
}else if(i===keyrp10_1[j][0] && keyrp10_3[i][4]===0){
tfmjr0=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1]/keyrp10_1[j][13]*100);
tfmjr7=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]/keyrp10_1[j][13]*100);
tfmnr0=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1]/keyrp10_1[j][13]*100);
tfmnr7=Math.round(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]/keyrp10_1[j][13]*100);
tfmjr07=((Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]))/keyrp10_1[j][13]*100).toFixed(2);
tfmnr07=((Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]))/keyrp10_1[j][13]*100).toFixed(2);
tfmjr_mnr=((
Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])
+Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[4])%12+1])
-Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])
-Number(keyrp10_1[j][(keyrp10_3[i][1]+scaleMjr0[2])%12+1])
)/keyrp10_1[j][13]*100).toFixed(2);

ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[0])%12];
ctx2.fillRect(200,930+(i+1)*75,tfmjr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[4])%12];
ctx2.fillRect(200+tfmjr0,930+(i+1)*75,tfmjr7,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(400,930+(i+1)*75,tfmnr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[2])%12];
ctx2.fillRect(400+tfmnr0,930+(i+1)*75,tfmnr7,30);
ctx2.fillStyle="black";
if(tfmjr0>=10){
ctx2.fillText(tfmjr0,200,960+(i+1)*75);
}else{
ctx2.fillText("  " + tfmjr0,200,960+(i+1)*75);
}
if(tfmjr7>=10){
ctx2.fillText("+" + tfmjr7,230,960+(i+1)*75);
}else{
ctx2.fillText("+  " + tfmjr7,230,960+(i+1)*75);
}
if(tfmjr07>=10){
ctx2.fillText("= " + tfmjr07,280,960+(i+1)*75);
}else{
ctx2.fillText("=   " + tfmjr07,280,960+(i+1)*75);
}
if(tfmnr0>=10){
ctx2.fillText(tfmnr0,400,960+(i+1)*75);
}else{
ctx2.fillText("  " + tfmnr0,400,960+(i+1)*75);
}
if(tfmnr7>=10){
ctx2.fillText("+" + tfmnr7,430,960+(i+1)*75);
}else{
ctx2.fillText("+  " + tfmnr7,430,960+(i+1)*75);
}
if(tfmnr07>=10){
ctx2.fillText("= " + tfmnr07,480,960+(i+1)*75);
}else{
ctx2.fillText("=   " + tfmnr07,480,960+(i+1)*75);
}
if(tfmjr_mnr>0){
ctx2.fillStyle=col[keyrp10_3[i][1]];
ctx2.fillRect(600,930+(i+1)*75,tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(tfmjr_mnr>=10){
ctx2.fillText(tfmjr_mnr,600,960+(i+1)*75);
}else{
ctx2.fillText("  " + tfmjr_mnr,600,960+(i+1)*75);
}
keyrp10_4.push(engf1[keyrp10_3[i][1]] + " major");
}else if(tfmjr_mnr<0){
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(700,930+(i+1)*75,-tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(-tfmjr_mnr>=10){
ctx2.fillText(-tfmjr_mnr,700,960+(i+1)*75);
}else{
ctx2.fillText("  " + -tfmjr_mnr,700,960+(i+1)*75);
}
keyrp10_4.push(engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor");
}else if(tfmjr_mnr==0){
keyrp10_4.push(engf1[keyrp10_3[i][1]] + " major/" + engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor");
}//if(tfmjr_mnr)
}//if(keyrp10_3[i][4]===1){
}//for(j=0;j<keyrp10_1.length;j++){
}//for(i=0;i<keyrp10_3.length;i++){

//multiple best relative scales
ctx2.fillStyle="black";
for(i=0;i<4;i++){
	if(i>0 && keyrp10_4[i].includes("/") && keyrp10_4[i].includes(keyrp10_4[i-1]) && keyrp10_4[i]!=keyrp10_4[i-1]){
	keyrp10_4.splice(i,1,keyrp10_4[i-1]);			
	ctx2.fillText(keyrp10_4[i-1],810,960+(i+1)*75);
	}else if(i<9 && keyrp10_4[i].includes("/") && keyrp10_4[i].includes(keyrp10_4[i+1]) && keyrp10_4[i]!=keyrp10_4[i+1]){
	keyrp10_4.splice(i,1,keyrp10_4[i+1]);	
	ctx2.fillText(keyrp10_4[i+1],810,960+(i+1)*75);
	}else if(keyrp10_3[i][4]===0){
	ctx2.fillText(keyrp10_4[i],810,960+(i+1)*75);
	}
}

//weight double for first & last
keyrp10_4.push([keyrp10_4[0]]);
keyrp10_4.push([keyrp10_4[3]]);

keyrp10_4.sort();
keyrp10_5=[];
for(i=0;i<keyrp10_4.length;i++){
if(i===0 || keyrp10_4[i]!=keyrp10_4[i-1]){
keyrp10_5.push([keyrp10_4[i],1]);
}else{
keyrp10_5.push([keyrp10_4[i],keyrp10_5[i-1][1]+1]);
}//if()
}//for(i=0;i<keyrp10_4.length;i++){
keyrp10_5.sort(function( m, n){return n[1] - m[1];});
if(keyrp10_5[0][1]>keyrp10_5[1][1]){
ctx2.fillText(keyrp10_5[0][0] ,810,960+(11)*30);
}else{
ctx2.fillText("Unidentified" ,810,960+(11)*30);
}

}


function keyw2(){
canvas2.width = 1300;
canvas2.height = 1300;

msr_from=Number(document.form1.x_msrf.value);
msr_to=Number(document.form1.x_msrt.value);

tk_from=(Number(document.form1.x_msrf.value)-stm)*ppq*bttl/ntvl*4;
tk_to=(Number(document.form1.x_msrt.value)-stm)*ppq*bttl/ntvl*4;


ctx2.font="25px Arial";
ctx2.clearRect(0,0,1300,1300);
ctx2.lineWidth=1;
ctx2.fillStyle="black";
ctx2.fillText("Proportions of pitch classes in the time window and scatter plot of pitch classes and time",0,30);
ctx2.fillText("Note name #",0,60);
ctx2.fillText("Note name b",0,90);
ctx2.fillText("Time%",0,120);
ctx2.fillText("Measure",90,120);
ctx2.fillText("Total %",810,120);
ctx2.fillText("10",28,150);
ctx2.fillText("20",28,180);
ctx2.fillText("30",28,210);
ctx2.fillText("40",28,240);
ctx2.fillText("50",28,270);
ctx2.fillText("60",28,300);
ctx2.fillText("70",28,330);
ctx2.fillText("80",28,360);
ctx2.fillText("90",28,390);
ctx2.fillText("100",14,420);
ctx2.fillText("Total %",0,450);

for(i=0;i<=10;i++){
ctx2.fillStyle="black";
mslbl0=Math.floor(eott0/ppq/bttl*ntvl/4*i/10);
if(mslbl0>=1000){
ctx2.fillText(mslbl0,114,120+i*30);
}else if(mslbl0>=100){
ctx2.fillText(mslbl0,128,120+i*30);
}else if(mslbl0>=10){
ctx2.fillText(mslbl0,142,120+i*30);
}else if(mslbl0>0){
ctx2.fillText(mslbl0,156,120+i*30);
}

ctx2.beginPath();
ctx2.strokeStyle="gray";
ctx2.moveTo(0,120+i*30);
ctx2.lineTo(200,120+i*30);
ctx2.stroke();
ctx2.moveTo(0,450);
ctx2.lineTo(900,450);
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engs1[k],220+50*k,60);
ctx2.fillText(engf1[k],220+50*k,90);
ctx2.fillText((k%12).toString(12),220+50*k,120);
}

keyrp10_0=[];
for(let i=0;i<r1.length;i++){
let [midi, start]=r1[i];
if(start>=tk_from && start<tk_to){
ctx2.fillStyle=col[midi%12];
ctx2.fillRect(200+midi%12*50,120+start/eott0*300,50,1);
keyrp10_0.push([midi%12, start]);
}
}

ctx2.fillStyle="black";
ctx2.fillText("Proportions of keys and the best relative keys in the time window",0,510);
ctx2.fillText("Major scale",0,540);
ctx2.fillText("Minor scale",0,570);
ctx2.fillText("Measure range",0,600);
ctx2.fillText("Comments",810,600);
if(msr_from>=1000){
ctx2.fillText(msr_from,0,630);	
}else if(msr_from>=100){
ctx2.fillText(msr_from,14,630);	
}else if(msr_from>=10){
ctx2.fillText(msr_from,28,630);	
}else if(msr_from>=0){
ctx2.fillText(msr_from,42,630);	
}
if(msr_to>=1000){
ctx2.fillText(msr_to,114,630);	
}else if(msr_to>=100){
ctx2.fillText(msr_to,128,630);	
}else if(msr_to>=10){
ctx2.fillText(msr_to,142,630);	
}else if(msr_to>=0){
ctx2.fillText(msr_to,156,630);	
}

for(i=0;i<=1;i++){
ctx2.fillStyle="black";
ctx2.beginPath();
ctx2.moveTo(0,600+i*30);
ctx2.lineTo(1050,600+i*30);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

for(let k=0;k<=11;k++){
ctx2.fillStyle="black";
ctx2.fillText(engf1[k],220+50*k,540);
ctx2.fillText(engMnr1[(k+9)%12],220+50*k,570);
}

keyrp10_1=[];
kx0=0;
kx1=0;
kx2=0;
kx3=0;
kx4=0;
kx5=0;
kx6=0;
kx7=0;
kx8=0;
kx9=0;
kx10=0;
kx11=0;
kxttl=0;
for(j=0;j<keyrp10_0.length;j++){
		switch(Number(keyrp10_0[j][0])){
		case 0: kx0=kx0+1;break;
		case 1: kx1=kx1+1;break;
		case 2: kx2=kx2+1;break;
		case 3: kx3=kx3+1;break;
		case 4: kx4=kx4+1;break;
		case 5: kx5=kx5+1;break;
		case 6: kx6=kx6+1;break;
		case 7: kx7=kx7+1;break;
		case 8: kx8=kx8+1;break;
		case 9: kx9=kx9+1;break;
		case 10: kx10=kx10+1;break;
		case 11: kx11=kx11+1;break;
		}
		kxttl=kxttl+1;
}
keyrp10_1.push([0, kx0, kx1, kx2, kx3, kx4, kx5, kx6, kx7, kx8, kx9, kx10, kx11, kxttl]);

w0=0;
for(j=0;j<13;j++){
w0=Math.round(keyrp10_1[0][j+1]/keyrp10_1[0][13]*100);
if (j===12 && w0===100){
	ctx2.fillText(w0,810,450);
}else if (w0===100){
	ctx2.fillText(w0,200+50*j,450);
}else if(w0>=10){
	ctx2.fillText(w0,214+50*j,450);
}else{
	ctx2.fillText(w0,228+50*j,450);
}	
}


keyrp10_2=[];
	for(j=0;j<12;j++){
		num0=0;
		for(k=0;k<12;k++){
			if(scaleMjr0.includes((12-j+k)%12)){
			num0=num0+Number(keyrp10_1[0][k+1]);
			}
		}
		keyrp10_2.push([0, j, num0,keyrp10_1[0][13]]);
	}

keyrp10_2.sort(function(m,n){return n[2]-m[2];})

keyrp10_3=[];
		num1=0;
		num2=0;
		num3=0;
		num4=0;
	for (j=0;j<keyrp10_2.length;j++){
		if(num2<keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4=0;
		keyrp10_3.push([0,num1,num2,num3,num4]);
		}else if(num2===keyrp10_2[j][2]){
		num1=keyrp10_2[j][1];
		num2=keyrp10_2[j][2];
		num3=keyrp10_2[j][3];
		num4+=1;	
		keyrp10_3.push([0,num1,num2,num3,num4]);
		}
	}
	
	for(i=0;i<keyrp10_3.length;i++){
	ctx2.fillStyle=col[keyrp10_3[i][1]];
	ctx2.fillRect(200+50*keyrp10_3[i][1],600,50,30);
	}

	keyrp10_3.sort(function(m,n){return n[4]-m[4];})
	
	ctx2.fillStyle="black";
	if(keyrp10_3[0][4]>0){
	ctx2.fillText(keyrp10_3[0][4]+1+" best pairs",810,630);
	}

	keyrp10_3.sort(function(m,n){return m[1]-n[1];})
	
	w1=0;
	for(i=0;i<keyrp10_2.length;i++){
	ctx2.fillStyle="black";
	w1=Math.round(keyrp10_2[i][2]/keyrp10_2[i][3]*100)
		if (w1===100){
		ctx2.fillText(w1,200+50*keyrp10_2[i][1],630);
		}else if(w1>=10){
		ctx2.fillText(w1,214+50*keyrp10_2[i][1],630);
		}else{
		ctx2.fillText(w1,228+50*keyrp10_2[i][1],630);
		}
	}


ctx2.fillStyle="black";
ctx2.fillText("Comparing total proportions of the 1st and the 5th pitch classes of the best relative keys",0,690);
ctx2.fillText("Measure range",0,720);
ctx2.fillText("Major 1st+5th",200,720);
ctx2.fillText("Minor 1st+5th",400,720);
ctx2.fillText("Major",600,720);
ctx2.fillText("Minor",700,720);
ctx2.fillText("Estimated key",810,720);

for(i=0;i<=keyrp10_3.length;i++){
ctx2.beginPath();
ctx2.moveTo(0,720+i*30);
ctx2.lineTo(1050,720+i*30);
ctx2.strokeStyle="gray";
ctx2.stroke();
}

keyrp10_4=[];
for(i=0;i<keyrp10_3.length;i++){
if(msr_from>=1000){
ctx2.fillText(msr_from,0,750+30*i);	
}else if(msr_from>=100){
ctx2.fillText(msr_from,14,750+30*i);	
}else if(msr_from>=10){
ctx2.fillText(msr_from,28,750+30*i);	
}else if(msr_from>=0){
ctx2.fillText(msr_from,42,750+30*i);	
}
if(msr_to>=1000){
ctx2.fillText(msr_to,114,750+30*i);	
}else if(msr_to>=100){
ctx2.fillText(msr_to,128,750+30*i);	
}else if(msr_to>=10){
ctx2.fillText(msr_to,142,750+30*i);	
}else if(msr_to>=0){
ctx2.fillText(msr_to,156,750+30*i);	
}


tfmjr0=Math.round(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[0])%12+1]/keyrp10_1[0][13]*100);
tfmjr7=Math.round(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]/keyrp10_1[0][13]*100);
tfmnr0=Math.round(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[5])%12+1]/keyrp10_1[0][13]*100);
tfmnr7=Math.round(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]/keyrp10_1[0][13]*100);
tfmjr07=((Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])+Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[4])%12+1]))/keyrp10_1[0][13]*100).toFixed(2);
tfmnr07=((Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])+Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[2])%12+1]))/keyrp10_1[0][13]*100).toFixed(2);
tfmjr_mnr=((
 Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[0])%12+1])
+Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[4])%12+1])
-Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[5])%12+1])
-Number(keyrp10_1[0][(keyrp10_3[i][1]+scaleMjr0[2])%12+1])
)/keyrp10_1[0][13]*100).toFixed(2);

keyrp10_4.push([tfmjr07, engf1[keyrp10_3[i][1]] + " major"]);
keyrp10_4.push([tfmnr07, engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor"]);

ctx2.fillStyle=col[keyrp10_3[i][1]];
ctx2.fillRect(200,720+30*i,tfmjr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[4])%12];
ctx2.fillRect(200+tfmjr0,720+30*i,tfmjr7,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(400,720+30*i,tfmnr0,30);
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[2])%12];
ctx2.fillRect(400+tfmnr0,720+30*i,tfmnr7,30);
ctx2.fillStyle="black";

if(tfmjr0>=10){
ctx2.fillText(tfmjr0,200,750+30*i);
}else{
ctx2.fillText(tfmjr0,214,750+30*i);
}
if(tfmjr7>=10){
ctx2.fillText("+" + tfmjr7,230,750+30*i);
}else{
ctx2.fillText("+  " + tfmjr7,230,750+30*i);
}
if(tfmjr07>=10){
ctx2.fillText("= " + tfmjr07,280,750+30*i);
}else{
ctx2.fillText("=  " + tfmjr07,280,750+30*i);
}
if(tfmnr0>=10){
ctx2.fillText(tfmnr0,400,750+30*i);
}else{
ctx2.fillText(tfmnr0,414,750+30*i);
}
if(tfmnr7>=10){
ctx2.fillText("+" + tfmnr7,430,750+30*i);
}else{
ctx2.fillText("+  " + tfmnr7,430,750+30*i);
}
if(tfmnr07>=10){
ctx2.fillText("= " + tfmnr07,480,750+30*i);
}else{
ctx2.fillText("=  " + tfmnr07,480,750+30*i);
}

if(tfmjr_mnr>0){
ctx2.fillStyle=col[keyrp10_3[i][1]];
ctx2.fillRect(600,720+30*i,tfmjr_mnr,30);	
ctx2.fillStyle="black";
if(tfmjr_mnr>=10){
ctx2.fillText(tfmjr_mnr,600,750+30*i);
}else{
ctx2.fillText(tfmjr_mnr,614,750+30*i);
}
ctx2.fillText(engf1[keyrp10_3[i][1]] + " major",810,750+30*i);
}else if(tfmjr_mnr<0){
ctx2.fillStyle=col[(keyrp10_3[i][1]+scaleMjr0[5])%12];
ctx2.fillRect(700,720+30*i,-tfmjr_mnr,30);
ctx2.fillStyle="black";
if(-tfmjr_mnr>=10){
ctx2.fillText(-tfmjr_mnr,700,750+30*i);
}else{
ctx2.fillText(-tfmjr_mnr,714,750+30*i);
}
ctx2.fillText(engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor",810,750+30*i);
}else{
ctx2.fillStyle="black";
ctx2.fillText(engf1[keyrp10_3[i][1]] + " major / " + engMnr1[(keyrp10_3[i][1]+scaleMjr0[5])%12] + " minor",810,750+30*i);
}
}

keyrp10_4.sort(function(m,n){return n[0]-m[0]})
l=keyrp10_3.length;
ctx2.fillText("Conclusion",0,750+30*l);
if(keyrp10_4[0][0]>keyrp10_4[1][0]){
	ctx2.fillText(keyrp10_4[0][1],810,750+30*l);
}else{
	ctx2.fillText("",810,750+30*l);
}
}


function cover_l(){
	var element	= credit2;
	var opt = {
	margin:       50,
	filename:     file1name+'_Cover_L.pdf',
	image:        { type: 'jpeg', quality: 0.95 },
	html2canvas:  { scale: 2 },
	jsPDF:        { unit: 'pt', format: [850,600], orientation: 'l' }
	};

	html2pdf().set(opt).from(element).save();

}

function cover_p(){
	var element	= credit2;
	var opt = {
	margin:       100,
	filename:     file1name+'_Cover_P.pdf',
	image:        { type: 'jpeg', quality: 0.95 },
	html2canvas:  { scale: 2 },
	jsPDF:        { unit: 'pt', format: [600,850], orientation: 'p' }
	};

	html2pdf().set(opt).from(element).save();

}


function instrument1(){
canvas2.height = 1300;
ctx2.font="25px Arial";
ctx2.fillStyle="black";
ctx2.clearRect(0,0,1200,1300);
ctx2.fillText("Color",100,50);
ctx2.fillText("Channel",200,50);
ctx2.fillText("Instrument",350,50);

for(let i=0;i<=ch_max;i++){
let [channel,instNumber]=r6[i];
let instrument=instName[instNumber];
ctx2.fillStyle=col3[channel];
ctx2.beginPath();
ctx2.arc(110,30*(i+1)+40,10,0,2*Math.PI,false);
ctx2.fill();
ctx2.fillStyle="black";
if(channel===10){
ctx2.fillText(Number(channel)+1,200,30*(i+1)+50);
ctx2.fillText("Percussion",350,30*(i+1)+50);
}else{
ctx2.fillText(Number(channel)+1,200,30*(i+1)+50);
ctx2.fillText(instrument,350,30*(i+1)+50);
}
}
}

function color_sample1(){
szx=1080;
szy=1300;
canvas2.width = szx;
canvas2.height = szy;
ctx2.clearRect(0,0,1400,1400);

let kw=78;
let kw0=kw*12/7*3/5;
let kw1=kw*12/7*4/7;
let cl=kw/2;

ctx2.font="25px Arial";
ctx2.fillStyle="black";

ctx2.lineWidth=1;
for(let k=22;k<=107;k++){
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect((k-Math.floor(k/12)*12)*kw,(Math.floor(k/12)*2-2)*cl+10,kw,cl);
	if (k%12===0) {
		ctx2.beginPath();
		ctx2.arc((k-Math.floor(k/12)*12)*kw+37,(Math.floor(k/12)*2-2)*cl+31,cl/3,0,2*Math.PI,false);
		ctx2.fillStyle="white";
		ctx2.fill();
		ctx2.fillStyle="black";
		ctx2.fillText(Math.floor(k/12), (k-Math.floor(k/12)*12)*kw+30,(Math.floor(k/12)*2-2)*cl+40);
	}
if(k%12<=4){
ctx2.fillStyle=col[k%12];
ctx2.fillRect((k-Math.floor(k/12)*12)*kw0,(Math.floor(k/12)*2-1)*cl+10,kw0,cl);
ctx2.beginPath();
ctx2.arc((k-Math.floor(k/12)*12)*kw0+37,(Math.floor(k/12)*2-1)*cl+31,cl/3,0,2*Math.PI,false);
ctx2.fillStyle="white";
ctx2.fill();
ctx2.fillStyle="black";
ctx2.fillText(k%12, (k-Math.floor(k/12)*12)*kw0+30,(Math.floor(k/12)*2-1)*cl+40);
}else{
ctx2.fillStyle=col[k%12];
ctx2.fillRect(3*kw*12/7+(k-Math.floor(k/12)*12-5)*kw1,(Math.floor(k/12)*2-1)*cl+10,kw1,cl);
ctx2.beginPath();
ctx2.arc(3*kw*12/7+(k-Math.floor(k/12)*12-5)*kw1+37,(Math.floor(k/12)*2-1)*cl+31,cl/3,0,2*Math.PI,false);
ctx2.fillStyle="white";
ctx2.fill();
ctx2.fillStyle="black";
ctx2.fillText((k%12).toString(12), 3*kw*12/7+(k-Math.floor(k/12)*12-5)*kw1+30,(Math.floor(k/12)*2-1)*cl+40);
}
ctx2.strokeStyle="black";

if(Math.floor(k/12)<=8){
ctx2.beginPath();
ctx2.moveTo(0,(Math.floor(k/12)*2)*cl+10);
ctx2.lineTo(13*kw,(Math.floor(k/12)*2)*cl+10);
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(13*kw,(Math.floor(k/12)*2-2)*cl+10);
ctx2.lineTo(13*kw,(Math.floor(k/12)*2)*cl+10);
ctx2.stroke();
if(k%12===0){
ctx2.beginPath();
ctx2.moveTo(12*kw,(Math.floor(k/12)*2-2)*cl+10);
ctx2.lineTo(12*kw,(Math.floor(k/12)*2)*cl+10);
ctx2.strokeStyle="blue";
ctx2.stroke();
}
if(k%12===5){
ctx2.beginPath();
ctx2.moveTo(5*kw0,(Math.floor(k/12)*2-2)*cl+10);
ctx2.lineTo(5*kw0,(Math.floor(k/12)*2)*cl+10);
ctx2.strokeStyle="red";
ctx2.stroke();
}
}
}
ctx2.fillStyle=col2[Math.floor(21/12)-1];
ctx2.fillRect(5*kw0+4*kw1,(Math.floor(21/12)*2-2)*cl+10,kw1,cl);
ctx2.beginPath();
ctx2.arc(5*kw0+4*kw1+37,(Math.floor(21/12)*2-2)*cl+31,cl/3,0,2*Math.PI,false);
ctx2.fillStyle="white";
ctx2.fill();
ctx2.fillStyle="black";
ctx2.fillText(Math.floor(21/12), 5*kw0+4*kw1+30,(Math.floor(21/12)*2-2)*cl+40);
ctx2.fillStyle=col[21%12];
ctx2.fillRect(5*kw0+4*kw1,(Math.floor(21/12)*2-1)*cl+10,kw1,cl);
ctx2.beginPath();
ctx2.arc(5*kw0+4*kw1+37,(Math.floor(21/12)*2-1)*cl+31,cl/3,0,2*Math.PI,false);
ctx2.fillStyle="white";
ctx2.fill();
ctx2.fillStyle="black";
ctx2.fillText(Math.floor(21%12), 5*kw0+4*kw1+30,(Math.floor(21/12)*2-1)*cl+40);

ctx2.beginPath();
ctx2.moveTo(5*kw*12/7,(Math.floor(21/12)*2-2)*cl+10);
ctx2.lineTo(5*kw*12/7,(Math.floor(21/12)*2)*cl+10);
ctx2.stroke();

ctx2.beginPath();
ctx2.moveTo(5*kw*12/7,(Math.floor(21/12)*2-2)*cl+10);
ctx2.lineTo(13*kw,(Math.floor(21/12)*2-2)*cl+10);
ctx2.stroke();

ctx2.fillStyle=col2[Math.floor(108/12)-1];
ctx2.fillRect(12*kw,(Math.floor(107/12)*2-2)*cl+10,kw,cl);
ctx2.beginPath();
ctx2.arc(12*kw+37,(Math.floor(107/12)*2-2)*cl+31,cl/3,0,2*Math.PI,false);
ctx2.fillStyle="white";
ctx2.fill();
ctx2.fillStyle="black";
ctx2.fillText(Math.floor(108/12), 12*kw+30,(Math.floor(107/12)*2-2)*cl+40);
ctx2.fillStyle=col[108%12];
ctx2.fillRect(12*kw,(Math.floor(107/12)*2-1)*cl+10,kw,cl);
ctx2.beginPath();
ctx2.arc(12*kw+37,(Math.floor(107/12)*2-1)*cl+31,cl/3,0,2*Math.PI,false);
ctx2.fillStyle="white";
ctx2.fill();
ctx2.fillStyle="black";
ctx2.fillText(Math.floor(108%12), 12*kw+30,(Math.floor(107/12)*2-1)*cl+40);

ctx2.beginPath();
ctx2.moveTo(12*kw,(Math.floor(107/12)*2)*cl+10);
ctx2.lineTo(13*kw,(Math.floor(107/12)*2)*cl+10);
ctx2.stroke();

ctx2.beginPath();
ctx2.moveTo(13*kw,(Math.floor(107/12)*2-1)*cl+10);
ctx2.lineTo(13*kw,(Math.floor(107/12)*2)*cl+10);
ctx2.stroke();

ctx2.beginPath();
ctx2.moveTo(12*kw,(Math.floor(23/12)*2-2)*cl+10);
ctx2.lineTo(12*kw,(Math.floor(23/12)*2)*cl+10);
ctx2.strokeStyle="blue";
ctx2.stroke();

ctx2.beginPath();
ctx2.moveTo(12*kw,(Math.floor(107/12)*2-2)*cl+10);
ctx2.lineTo(12*kw,(Math.floor(107/12)*2)*cl+10);
ctx2.strokeStyle="blue";
ctx2.stroke();

ctx2.beginPath();
ctx2.moveTo(5*kw0,(Math.floor(107/12)*2-2)*cl+10);
ctx2.lineTo(5*kw0,(Math.floor(107/12)*2)*cl+10);
ctx2.strokeStyle="red";
ctx2.stroke();

let x0=0;
let y0=660;
let l0=50;

for(let l=0;l<=12;l++){
if(l%12===1||l%12===3){
ctx2.fillStyle="lightgray";
ctx2.fillRect(l*kw0+x0,y0,kw0,l0);
ctx2.beginPath();
}else if(l%12===6||l%12===8||l%12===10){
ctx2.fillStyle="lightgray";
ctx2.fillRect(3*kw*12/7+(l-5)*kw1+x0,y0,kw1,l0);
ctx2.beginPath();
}
}

for(let m=0;m<=7;m++){
if(m%7===0||m%7===3){
ctx2.beginPath();
ctx2.moveTo(m*kw*12/7+x0,y0);
ctx2.lineTo(m*kw*12/7+x0,l0*2+y0);
ctx2.strokeStyle="black";
ctx2.stroke();
}else{
ctx2.beginPath();
ctx2.moveTo(m*kw*12/7+x0,l0+y0);
ctx2.lineTo(m*kw*12/7+x0,l0*2+y0);
ctx2.strokeStyle="black";
ctx2.stroke();
}
}

ctx2.beginPath();
ctx2.moveTo(x0,y0);
ctx2.lineTo(kw*12+x0,y0);
ctx2.strokeStyle="black";
ctx2.stroke();

ctx2.beginPath();
ctx2.moveTo(x0,l0*2+y0);
ctx2.lineTo(kw*12+x0,l0*2+y0);
ctx2.strokeStyle="black";
ctx2.stroke();



let x2=0;
let y2=1000;

let kw20=10;
let kw21=kw20*12/7*3/5;
let kw22=kw20*12/7*4/7;
let kw23=kw20*12/7;
let kl0=10*kw20;
let kl1=14*kw20;

for(let l=0;l<=51;l++){
if((l+5)%7===0){
ctx2.beginPath();
ctx2.moveTo(l*kw23+x2,y2);
ctx2.lineTo(l*kw23+x2,2*kw20+y2);
ctx2.strokeStyle="blue";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(l*kw23+x2,2*kw20+y2);
ctx2.lineTo(l*kw23+x2,kl1+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
}else if((l+5)%7===3){
ctx2.beginPath();
ctx2.moveTo(l*kw23+x2,y2);
ctx2.lineTo(l*kw23+x2,2*kw20+y2);
ctx2.strokeStyle="red";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(l*kw23+x2,2*kw20+y2);
ctx2.lineTo(l*kw23+x2,kl1+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
}else{
ctx2.beginPath();
ctx2.moveTo(l*kw23+x2,kl0+y2);
ctx2.lineTo(l*kw23+x2,kl1+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
}
}

for(let k=21;k<=108;k++){
if(k%12>=0 && k%12<=4){
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(2*kw23+Math.floor(k/12-2)*12*kw20+k%12*kw20+x2,y2,kw20,kw20);
ctx2.font="10px Arial";
ctx2.fillStyle="black";
	if(k%12===0){
	ctx2.fillText(Math.floor(k/12), 2*kw23+Math.floor(k/12-2)*12*kw20+k%12*kw20+x2+2,y2-16);
	}
ctx2.fillStyle=col[k%12];
ctx2.fillRect(2*kw23+Math.floor(k/12-2)*12*kw20+k%12*kw20+x2,kw20+y2,kw20,kw20);
ctx2.font="10px Arial";
ctx2.fillStyle="black";
ctx2.fillText(k%12, 2*kw23+Math.floor(k/12-2)*12*kw20+k%12*kw20+x2+2,kw20+y2-16);
}else{
ctx2.fillStyle=col2[Math.floor(k/12)-1];
ctx2.fillRect(2*kw23+Math.floor(k/12-2)*12*kw20+5*kw21+(k%12-5)*kw22+x2,y2,kw22,kw20);
ctx2.font="10px Arial";
ctx2.fillStyle="black";
	if(k===21){
	ctx2.fillText(Math.floor(k/12), 2*kw23+Math.floor(k/12-2)*12*kw20+5*kw21+(k%12-5)*kw22+x2+2,y2-16);
	}
ctx2.fillStyle=col[k%12];
ctx2.fillRect(2*kw23+Math.floor(k/12-2)*12*kw20+5*kw21+(k%12-5)*kw22+x2,kw20+y2,kw21,kw20);
ctx2.font="10px Arial";
ctx2.fillStyle="black";
ctx2.fillText((k%12).toString(12), 2*kw23+Math.floor(k/12-2)*12*kw20+5*kw21+(k%12-5)*kw22+x2+2,kw20+y2-16);
}

if(k%12===1||k%12===3){
ctx2.fillStyle="black";
ctx2.fillRect(2*kw23+Math.floor(k/12-2)*12*kw20+k%12*kw21+x2,2*kw20+y2,kw21,8*kw20);
}else if(k%12===6||k%12===8||k%12===10){
ctx2.fillStyle="black";
ctx2.fillRect(2*kw23+Math.floor(k/12-2)*12*kw20+5*kw21+(k%12-5)*kw20+x2,2*kw20+y2,kw20,8*kw20);
}else if(k%12===0){
ctx2.beginPath();
ctx2.moveTo(2*kw23+Math.floor(k/12-2)*12*kw20+x2,y2-30);
ctx2.lineTo(2*kw23+Math.floor(k/12-2)*12*kw20+x2,14*kw20+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
}
}

ctx2.beginPath();
ctx2.moveTo(x2,y2-30);
ctx2.lineTo(52*kw23+x2,y2-30);
ctx2.strokeStyle="black";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(x2,y2);
ctx2.lineTo(52*kw23+x2,y2);
ctx2.strokeStyle="black";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(x2,2*kw20+y2);
ctx2.lineTo(52*kw23+x2,2*kw20+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(x2,14*kw20+y2);
ctx2.lineTo(52*kw23+x2,14*kw20+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(x2,15*kw20+y2);
ctx2.lineTo(52*kw23+x2,15*kw20+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(x2,y2-30);
ctx2.lineTo(x2,15*kw20+y2);
ctx2.strokeStyle="black";
ctx2.stroke();
ctx2.beginPath();
ctx2.moveTo(52*kw23+x2,y2-30);
ctx2.lineTo(52*kw23+x2,15*kw20+y2);
ctx2.strokeStyle="black";
ctx2.stroke();

}


function selview1(){
if(document.form1.sv1.options[0].selected==true){
	scroll1();
}else if(document.form1.sv1.options[1].selected==true){
	scroll2();
}else if(document.form1.sv1.options[2].selected==true){
	still1();
}else if(document.form1.sv1.options[3].selected==true){
	still2();
}else if(document.form1.sv1.options[4].selected==true){
color_sample1();
}else if(document.form1.sv1.options[5].selected==true){
touch_sound1();
}else if(document.form1.sv1.options[6].selected==true){
instrument1();
}else if(document.form1.sv1.options[7].selected==true){
keyw1();
}else if(document.form1.sv1.options[8].selected==true){
keyw3();
}else if(document.form1.sv1.options[9].selected==true){
keyw4();
}else if(document.form1.sv1.options[10].selected==true){
index1();
}else if(document.form1.sv1.options[11].selected==true){
information1();
}else if(document.form1.sv1.options[12].selected==true){
chord_pt();
}else if(document.form1.sv1.options[13].selected==true){
chord_ji();
}else if(document.form1.sv1.options[14].selected==true){
chord_12et();
}else if(document.form1.sv1.options[15].selected==true){
finger3();
}else if(document.form1.sv1.options[16].selected==true){
finger2();
}else if(document.form1.sv1.options[17].selected==true){
downloadFile(file1name+'_Ch'+(Number(x_ch1)+1)+'H'+fg1v+'L'+fg2v+'X'+fg3v+'C'+fg4v+'N'+fg5v+'n'+fg6v+'r'+fg7v+'R'+fg8v+'.csv', 'data:text/csv;charset=UTF-8,' + encodeURIComponent(f110));
}else if(document.form1.sv1.options[18].selected==true){
download1();
}else if(document.form1.sv1.options[19].selected==true){
cover_l();
}else if(document.form1.sv1.options[20].selected==true){
cover_p();
}

}


</script>
</body>
</html>























